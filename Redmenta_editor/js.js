var xmlhttp=(window.XMLHttpRequest)?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var formdata=false;var formdata2=false;if(window.FormData){formdata=new FormData();formdata2=new FormData();}else{}
var already_in_formdata=new Array;var timer,loading;var getTipusNev=new Array();getTipusNev[1]=lang['simple_choice'];getTipusNev[2]=lang['multiple_choice'];getTipusNev[3]=lang['true_or_false'];getTipusNev[4]=lang['essay'];getTipusNev[5]=lang['one_word'];getTipusNev[6]=lang['scale'];getTipusNev[7]=lang['matching'];getTipusNev[8]=lang['sequencing'];var keresett_kerdesek=new Array;var ks_kerdesek=new Array;var akt_kerdes=0;var ks_meta=new Array;ks_meta['cim']='';ks_meta['leiras']='';ks_meta['cimkek']='';var ks_meta_hiba=0;var ks_id=0;var ks_cache=new Array;var ks_pont_cache=new Array;var blockEditPont=1;var idozittomb=new Array();var ww;var hh;var maxh=0;var alaphelyzet,akthelyzet;var mozdult=false;var last_postdata;var last_response;var forceponteditview=false,getTheTaskAfterSave=false;var loadmore_counter=0;var selectedCimkek=new Array;var selectedCimkekKs=new Array;var attachments=new Array;var oldaltoresek=new Array;var timer2;var timer3;var latestSearchWord="";var lastSave=0;var onloading=false;var onnewkerdes=false;var st_title="";var st_desc="";var myvotes=new Array;var q_permission=1;var good_answers=new Array;var editable_tasks=new Array;var allitasValasz=new Array;var saving=false;var changeTasks=false;var delTasks=false;var keresmezo,talalatmezo,actionfuggveny,latestSearchWord2={};var maxfilesN=6;var profilePic;var t;var qrpopup;var pic_upload_error={};var uploadedFileProperties={};var popupstate="closed";var lastAjanlo="";var lastUsedCimkek=new Array;var lastUsedCimkekKs=new Array;var ajanlottCimkekKsGlobal=new Array;var adjustTime=0;function getRedTime(){return Math.floor(new Date().getTime()/1000)+adjustTime;}
function setNewTimer(){var container=document.getElementById("ksKitIdolimit");var start=parseInt(container.getAttribute("data-start"));if(start==0){start=getRedTime();container.setAttribute("data-start",start);}
var limit=parseInt(container.getAttribute("data-limit"))*60;var remaining=start+limit-getRedTime();if(remaining>0){var hours=Math.floor(remaining/3600);remaining-=hours*3600;var minutes=Math.floor(remaining/60);var seconds=remaining%60;if(minutes<10)minutes="0"+minutes;if(seconds<10)seconds="0"+seconds;var remaining_string=hours+":"+minutes+":"+seconds;container.innerHTML=remaining_string;setTimeout(setNewTimer,1000);}else{ksLejart();}}
var mire2020={};window.onload=function(){$("#ga_redm_banner2020_next_1").click(function(){$("#new_banner_2020_content_page_1").fadeOut({done:function(){$("#new_banner_2020_content_page_2").fadeIn();}});});$("#ga_redm_banner2020_next_2").click(function(){$("#new_banner_2020_content_page_2").fadeOut({done:function(){$("#new_banner_2020_content_page_3").fadeIn();}});});$("#ga_redm_banner2020_cta_3").click(function(){ajax2('saveBannerCTA3',null,function(){$("#new_banner_2020").fadeOut();});});$(".gomb_2020_mire").click(function(){mire2020.mire=$(this).data('mire');if(mire2020.mire===1){$("#new_popup_2020_hol").hide();}else{$("#new_popup_2020_hol").show();}
$("#new_popup_2020_content_1").fadeOut({done:function(){$("#new_popup_2020_content_2").fadeIn();}});});$("#new_popup_2020_vissza").click(function(){$("#new_popup_2020_content_2").fadeOut({done:function(){$("#new_popup_2020_content_1").fadeIn();}});});$(".gomb_2020_hol").click(function(){mire2020.hol=$(this).data('hol');$(".gomb_2020_hol").removeClass('gomb_2020_green');$(".gomb_2020_hol").addClass('gomb_2020_orange');$(this).addClass('gomb_2020_green');});$("#new_popup_2020_save").click(function(){mire2020.birthday=$("#new_popup_2020_birthday").val();mire2020.tos=$("#new_popup_2020_tos").prop('checked');if((mire2020.mire===1||mire2020.hol)&&mire2020.birthday&&mire2020.tos){console.log("VALID");ajax2('saveAlap2020',mire2020,function(){$("#new_popup_2020_overlay").fadeOut();$("#new_popup_2020").fadeOut();});}else{console.log("INVALID");}});var newtimers=document.getElementsByClassName("timer2020");if(newtimers.length){var localTime=getRedTime();var serverTime=parseInt(newtimers[0].getAttribute("data-server-time"));if(localTime<serverTime){adjustTime=serverTime-localTime;}}
setupfeedback();refreshKerdesListOnclick();var ks_Kereses=document.getElementById('ksKereses');var ks_Kereses_own=document.getElementById('cloudkeres');var newKerdes=document.getElementById('ksUjKerdes');var editKerdes=document.getElementById('ksEditFeladat');var addToKs=document.getElementById('addToKs');var delFromKs=document.getElementById('delFromKs');var mentKs=document.getElementById('mentKs');var setKsMeta=document.getElementById('setKsMeta');var setKsMeta2=document.getElementById('setKsMeta2');var newKs=document.getElementById('newKs');var newKsClone=document.getElementById('newKsClone');var newGroup=document.getElementById('newGroup');var ksEditPontok=document.getElementById('ksEditPontok');var kerdesPontokSubmit=document.getElementById('kerdesPontokSubmit');var saveMegosztas=document.getElementById('saveMegosztas');var setMeghivas=document.getElementById('setMeghivas');var jumper=document.getElementById('jumperSave');var oldaltoresNew=document.getElementById('oldaltoresNew');var setPonthatarok=document.getElementById('setPonthatarok');var editProfilPic=document.getElementById('editProfilPic');var apprvr=document.getElementById('apprvr');var toFolder=document.getElementById('toFolder');var toEmbed=document.getElementById('toEmbed');var toPrint=document.getElementById('toPrint');if(ks_Kereses)ks_Kereses.onkeydown=function(){clearTimeout(timer2);keyEvent(function(){ksKereses(false);},13)};if(ks_Kereses)ks_Kereses.onkeyup=function(){clearTimeout(timer2);timer2=setTimeout(function(){ksKereses(false);},1200);};if(ks_Kereses)ks_Kereses.onchange=function(){clearTimeout(timer2);ksKereses(false);};if(ks_Kereses_own)ks_Kereses_own.onkeydown=function(){clearTimeout(timer3);keyEvent(function(){ksKereses(true);},13)};if(ks_Kereses_own)ks_Kereses_own.onkeyup=function(){clearTimeout(timer3);timer3=setTimeout(function(){ksKereses(true);},1200);};if(ks_Kereses_own)ks_Kereses_own.onchange=function(){clearTimeout(timer3);ksKereses(true);};var userKereses=document.getElementById('userKeres');if(userKereses){userKereses.onkeydown=function(){clearTimeout(timer2);keyEvent(function(){obj_keres(1);},13)};userKereses.onkeyup=function(){clearTimeout(timer2);timer2=setTimeout(function(){obj_keres(1);},1200);};userKereses.onchange=function(){clearTimeout(timer2);obj_keres(1);};}
var userKereses2=document.getElementById('userKeres2');if(userKereses2){userKereses2.onkeydown=function(){clearTimeout(timer2);keyEvent(function(){obj_keres(2);},13)};userKereses2.onkeyup=function(){clearTimeout(timer2);timer2=setTimeout(function(){obj_keres(2);},1200);};userKereses2.onchange=function(){clearTimeout(timer2);obj_keres(2);};}
var groupName=document.getElementById('groupName');if(groupName){groupName.onkeydown=function(){clearTimeout(timer2);keyEvent(function(){obj_keres(3);},13)};groupName.onkeyup=function(){clearTimeout(timer2);timer2=setTimeout(function(){obj_keres(3);},1200);};groupName.onchange=function(){clearTimeout(timer2);obj_keres(3);};}
var apprvr2=document.getElementsByClassName('apprvr2');for(var i=0,max=apprvr2.length;i<max;i++){apprvr2[i].onclick=function(){approveAllResults(this);};}
if(toFolder)toFolder.onclick=openToFolder;if(toEmbed)toEmbed.onclick=openToEmbed;if(toPrint)toPrint.onclick=openPrintDialog;if(apprvr)apprvr.onclick=approveResults;if(jumper)jumper.onclick=saveJumper;if(newKerdes)newKerdes.onclick=getUjKerdesForm;if(editKerdes)editKerdes.onclick=getEditKerdesForm;if(addToKs)addToKs.onclick=addKerdesToKs;if(delFromKs)delFromKs.onclick=delKerdesFromKs;if(mentKs)mentKs.onclick=function(){mentKerdessor();};if(setKsMeta)setKsMeta.onclick=openKsMetaBox;if(setKsMeta2)setKsMeta2.onclick=function(){openKsMetaBox2(0)};if(newKs)newKs.onclick=ujKs;if(newKsClone)newKsClone.onclick=ujKs;var newKsCloneCatalog=document.getElementsByClassName('newKsCloneCatalog');for(var i=0,max=newKsCloneCatalog.length;i<max;i++){newKsCloneCatalog[i].onclick=function(){ks_id=this.getAttribute('data-ks-id');ujKs();};}
if(newGroup)newGroup.onclick=openNewGroupBox;if(ksEditPontok)ksEditPontok.onclick=pontEditView;if(kerdesPontokSubmit)kerdesPontokSubmit.onclick=mentPontok;if(document.getElementById('valogatott_kerdesek')){refreshKerdesLista();}
if(saveMegosztas)saveMegosztas.onclick=megosztasSave;if(setMeghivas)setMeghivas.onclick=meghivasPopup;if(oldaltoresNew)oldaltoresNew.onclick=oldaltoresBeszur;if(setPonthatarok)setPonthatarok.onclick=openPonthatarEditor;if(document.getElementById("editgroupbutton")){document.getElementById("editgroupbutton").onclick=function(){csid=QueryString.csid;openPopupWindow(lang['editgroup'],13,450,csid);}}
addbutton("csow1",addToWaitingList);addbutton("csow2",removeFromWaitingList);addbutton("feedbacktool",toggleFeedback);addbutton("toQR",openqrpage);refreshSettings();reloadKsKerdesek();var editProfil=document.getElementById('editProfil');if(editProfil)editProfil.onclick=showProfileEditForm;if(editProfilPic){editProfilPic.onclick=function(){openPopupWindow(lang['change_profile_pic'],14,500);}}
editFoldersButton();delKsButton();if(document.getElementById("whichPublicity")){document.getElementById("whichPublicity").onclick=function(){openPopupWindow(lang['which_publicity'],23,600);}}
if(document.getElementById("whichPublicity2")){document.getElementById("whichPublicity2").onclick=function(){openPopupWindow(lang['which_publicity'],23,600);}}
if(document.getElementById("copyShare")){document.getElementById("copyShare").onclick=function(){var copyText=document.getElementById("copyShareInput");copyText.focus();copyText.select();copyText.setSelectionRange(0,copyText.value.length);document.execCommand("copy");document.getElementById("copyShareSuccess").style.display="inline";}}
var tovabb=document.getElementById('tovabb');var start=document.getElementById('ksStart');var start2=document.getElementById('ksStartAsNewUser');var vissza=document.getElementById('vissza');var feladat=document.getElementById('feladatBazis');var deleteTempUserSession=document.getElementById('deleteTempUserSession');if(tovabb)tovabb.onclick=function(){if(ks_id==24242424&&typeof(Storage)!=="undefined"){timer24=-1;localStorage.timer24=timer24;}
kerdesTovabb(1);};if(start)start.onclick=function(){if(ks_id==24242424){gebi("swstartimg").src="design/sw/start2.gif";setTimeout(function(){displayTempUserFormOrNext(0,1)},1250);}else{displayTempUserFormOrNext(0,1);}};if(start2)start2.onclick=function(){displayTempUserFormOrNext(1,1)};if(vissza)vissza.onclick=function(){kerdesTovabb(-1)};if(feladat){refreshFeladatOptions();}
if(deleteTempUserSession)deleteTempUserSession.onclick=function(){delTempUserSess()};voteInit();dragAndDropInit();settimer();idozit();setInterval(idozit,1000);var elems=document.getElementsByClassName("addOrDel");for(i=0;i<elems.length;i++){elems[i].style.display="none";}
if(document.getElementById("infobar-close")){document.getElementById("infobar-close").onclick=function(){closeinfobar();}}
if(window.innerHeight){hh=window.innerHeight;ww=window.innerWidth;}else if(document.body.clientHeight){hh=document.body.clientHeight;ww=document.body.clientWidth;}else if(document.documentElement.clientHeight){hh=document.documentElement.clientHeight;ww=document.documentElement.clientWidth;}else{alert(lang['old_browser']);return;}
check_if_embeded();resize();resize();}
window.onresize=function(){resize();resize();if(draggableResize){draggableResize();}}
function addbutton(id,action){var btn=document.getElementById(id);if(btn)btn.onclick=action;}
function closeinfobar(){if(document.getElementById("infobar")){document.getElementById("infobar").style.display="none";var d=new Date();d.setTime(d.getTime()+(10*365*24*60*60*1000));var expires=d.toGMTString();document.cookie="acceptcookie=1; expires="+expires;}}
function settimer(){var elem=document.getElementsByTagName("span");if(elem.length>0){var y=0;for(var x=0;x<elem.length;x++){if(elem[x].className=="timer"){var ora=elem[x].innerHTML.split(":")[0];var perc=elem[x].innerHTML.split(":")[1];var masodperc=elem[x].innerHTML.split(":")[2];idozittomb[y]=new Array();idozittomb[y][0]=elem[x];var idoo=mktime(ora,perc,masodperc);idozittomb[y][1]=idoo*1000;idozittomb[y][2]=new Date();idozittomb[y][3]=elem[x].id;y++;}}}}
function dragAndDropInit(){if(!ks_id)return;$("#valogatott_kerdesek").sortable({axis:"y",scroll:false,containment:"parent",zIndex:999,start:function(event,ui){alaphelyzet=ui.helper.context.offsetTop;},sort:function(event,ui){var itemPos=ui.helper.context.getBoundingClientRect().top+ui.helper.context.clientHeight/2+1;var windowH=window.innerHeight;if(itemPos>=(windowH-50)){window.scrollBy(0,10);}
if(itemPos<=50){window.scrollBy(0,-10);}
mozdult=true;},stop:function(event,ui){akthelyzet=ui.item.context.offsetTop;var itemPos=ui.offset.top;if(alaphelyzet!=akthelyzet){reloadKsKerdesek();mentKerdessor();}else if(Math.abs(alaphelyzet-itemPos)<5){var elem=ui.item.context.cloneNode();if(elem.id){document.getElementById(elem.id).onclick();}}
mozdult=false;}});}
function reloadKsKerdesek(){if(!document.getElementById('valogatott_kerdesek'))return false;var divek=document.getElementById('valogatott_kerdesek').getElementsByTagName('div');ks_kerdesek=new Array;oldaltoresek=new Array;for(var i=0;i<divek.length;i++){var realclass=divek[i].getAttribute('class').split(' ')[0];if(realclass=='sKerdes'){ks_kerdesek.push(divek[i].getAttribute('id').substr(2));}
else if(realclass=='oldaltores'){oldaltoresek.push(ks_kerdesek.length);divek[i].onmouseover=oldaltoresMouseOver;divek[i].onmouseout=oldaltoresMouseOut;}}}
function letsCreateGroup(){var title=document.getElementById("groupName").value;if(title.length>2){var params={};params['title']=title;ajax("letsCreateGroup",params,function(res){var csid=parseInt(res);if(csid>0){closepopup();window.location.href="?group&csid="+csid;}});}}
function refreshPopupSettings(){if(ismsie())$('input, textarea').placeholder();var saveKsMeta=document.getElementById('saveKsMeta');if(saveKsMeta)saveKsMeta.onclick=mentKsMeta;var saveKsMeta2=document.getElementById('saveKsMeta2');if(saveKsMeta2)saveKsMeta2.onclick=mentKsMeta;var saveGroupMeta=document.getElementById('saveGroupMeta');if(saveGroupMeta)saveGroupMeta.onclick=mentGroupMeta;var elems=document.getElementsByClassName("savedeadlines");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){saveKsSolvingSettings(this);};}
var elems=document.getElementsByClassName("saveclosedeadlines");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){saveKsSolvingSettings(this);closepopup();};}
var closeKsMeta=document.getElementById('closeKsMeta');if(closeKsMeta)closeKsMeta.onclick=function(){closepopup();};var elems=document.getElementsByClassName("closedlpopup");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){closepopup();};}
var saveJog=document.getElementById('saveJog');if(saveJog)saveJog.onclick=jogSave;var createGroup=document.getElementById('createGroup');if(createGroup)createGroup.onclick=letsCreateGroup;var addLinePercent=document.getElementById('addLinePercent');if(addLinePercent)addLinePercent.onclick=addPercent;var savePointLimit=document.getElementById('savePointLimit');if(savePointLimit)savePointLimit.onclick=mentPointLimit;var closePointLimit=document.getElementById('closePointLimit');if(closePointLimit)closePointLimit.onclick=function(){closepopup();};setupPointLimitCopy();var createSmartTestsheet=document.getElementById('createSmartTestsheet');if(createSmartTestsheet)createSmartTestsheet.onclick=createSmartTs;var saveSmartTestsheetCimkek=document.getElementById('saveSmartTestsheetCimkek');if(saveSmartTestsheetCimkek)saveSmartTestsheetCimkek.onclick=saveStCimkek;var closeSmartTestsheet=document.getElementById('closeSmartTestsheet');if(closeSmartTestsheet)closeSmartTestsheet.onclick=function(){closepopup();}
var delGroup=document.getElementById('delGroup');if(delGroup)delGroup.onclick=function(){if(!confirm(lang['gr_delete_confirm'])){closepopup();return false;}
var params={};params['csid']=QueryString.csid;ajax2('deleteGr',params,'','',1);window.location.href="?groups";};delKsButton();var delCurrentPic=document.getElementById('delCurrentPic');if(delCurrentPic)delCurrentPic.onclick=deleteCurrentProfilePic;var uploadProfilePic=document.getElementById('uploadProfilePic');if(uploadProfilePic)uploadProfilePic.onclick=uploadProfilePicture;var uploadDokumentum=document.getElementById('uploadDokumentum');if(uploadDokumentum)uploadDokumentum.onclick=uploadDokumentumFunction;var cs_createtm=document.getElementById('cs_createtm');if(cs_createtm)cs_createtm.onclick=temakorAction;setupObjButtons();var newfolder_action=document.getElementById("newfolder_action");if(newfolder_action)newfolder_action.onclick=createFolder;setupfolderselect();setPopupSize();setupnewpopup();}
function delKsButton(){var delKs=document.getElementById('delKs');if(delKs)delKs.onclick=delKsButtonClick;var delKs2=document.getElementById('delKs2');if(delKs2)delKs2.onclick=delKsButtonClick;}
function delKsButtonClick(){if(!confirm(lang['ks_delete_confirm'])){closepopup();return false;}
deleteThisKs();window.location.href="?";}
function refreshKerdesLista(){var sKerdes=document.getElementsByClassName('sKerdes');for(var i=0;i<sKerdes.length;i++){sKerdes[i].onmouseover=function(){this.getElementsByClassName('sCimkek')[0].style.visibility='hidden';this.getElementsByClassName('sType')[0].style.visibility='visible';}
sKerdes[i].onmouseout=function(){this.getElementsByClassName('sType')[0].style.visibility='hidden';this.getElementsByClassName('sCimkek')[0].style.visibility='visible';}
dragAndDropInit();}
if(document.getElementById("noTaskIn")){if(ks_kerdesek.length==0){if(document.getElementById("mentKs")){document.getElementById("mentKs").style.display="none";document.getElementById("oldaltoresNew").style.display="none";}
document.getElementById("noTaskIn").style.display="block";}
else{if(document.getElementById("mentKs")){document.getElementById("mentKs").style.display="block";document.getElementById("oldaltoresNew").style.display="block";}
if(document.getElementById("noTaskIn")){document.getElementById("noTaskIn").style.display="none";}}}}
function refreshSettings(){setupRedLatex();setFilterForResults();setupnewpopup();if(ismsie())$('input, textarea').placeholder();var selectJoValasz=document.getElementsByClassName('selectJoValasz');var selectJoValaszMultiple=document.getElementsByClassName('selectJoValaszMultiple');var selectJoValaszMultipleMegse=document.getElementsByClassName('selectJoValaszMultipleMegse');var ertekelesTipusa=document.getElementById('ertekelesTipusa');var vane_szolimit=new Array(document.getElementById('van_szolimit'),document.getElementById('nincs_szolimit'));var szazalek_valt=new Array(document.getElementById('szolimit'),document.getElementById('elteres_szazalek'));var cimkekDiv=document.getElementById('cimkekDiv');var cimkek=document.getElementById('cimkek');var addValasz1=document.getElementById('addValasz1');var addValasz2=document.getElementById('addValasz2');var addValasz3=document.getElementById('addValasz3');var addAllitas=document.getElementById('addAllitas');var addAllitas2=document.getElementById('addAllitas2');var addSor=document.getElementById('addSor');var addSor2=document.getElementById('addSor2');var attachment=document.getElementById('attachment');var attachment_input=document.getElementById('attachment_input');var fcs=document.getElementById('feladat_csalad');var fcs_input=document.getElementById('fcs_input');var venevalasz=new Array(document.getElementById('van_valasz'),document.getElementById('nincs_valasz'));var skala_valaszok_szama=document.getElementById('skala_valaszok_szama');var delAnswerOption=document.getElementsByClassName('delAnswerOption');var skala_good_answer=document.getElementsByClassName('skala_good_answer');var delTask=document.getElementById('DelFeladat');if(delTask)delTask.onclick=function(){openPopupWindow(lang['delTasksPopup'],10);};var post_my_score=document.getElementById('post_my_score');if(post_my_score)post_my_score.onclick=postScoreToWall;var fb_login_link=document.getElementById('fb_login_link');if(fb_login_link)fb_login_link.onclick=fb_login;var saveKerdes=document.getElementById('saveKerdes');if(saveKerdes)saveKerdes.onclick=beforeSaveKerdes;var set_Feladattipus=document.getElementById('setFeladattipus');if(set_Feladattipus)set_Feladattipus.onchange=setFeladattipus;if(selectJoValasz.length){for(var i=0;i<selectJoValasz.length;i++){selectJoValasz[i].onclick=setAsJoValasz;}}
if(selectJoValaszMultiple.length){for(var i=0;i<selectJoValaszMultiple.length;i++){selectJoValaszMultiple[i].onclick=setAsJoValaszMultiple;}}
if(selectJoValaszMultipleMegse.length){for(var i=0;i<selectJoValaszMultipleMegse.length;i++){selectJoValaszMultipleMegse[i].onclick=setAsJoValaszMultipleCancel;}}
if(skala_good_answer.length){for(var i=0;i<skala_good_answer.length;i++){skala_good_answer[i].onchange=setJoValaszSkala;}}
if(delAnswerOption.length){for(var i=0;i<delAnswerOption.length;i++){delAnswerOption[i].onclick=delThisAnswer;}}
if(ertekelesTipusa)ertekelesTipusa.onchange=setErtekelesTipusa;if(vane_szolimit[0]){vane_szolimit[0].onchange=szolimitSzerk;vane_szolimit[1].onchange=szolimitSzerk;}
if(venevalasz[0]){venevalasz[0].onchange=egyszavasSzerk;venevalasz[1].onchange=egyszavasSzerk;}
if(szazalek_valt[0]){szazalek_valt[0].onchange=setLimitDemo;szazalek_valt[1].onchange=setLimitDemo;}
if(cimkekDiv){cimkekDiv.onclick=function(){document.getElementById('cimkek').focus();};}
if(cimkek){cimkek.onchange=createCimkeSpan;}
if(addValasz1){addValasz1.onclick=function(){valaszAdd(1);};}
if(addValasz2){addValasz2.onclick=function(){valaszAdd(2);};}
if(addValasz3){addValasz3.onclick=function(){valaszAdd(5);};}
if(addAllitas){addAllitas.onclick=function(){valaszAdd(3);};}
if(addAllitas2){addAllitas2.onclick=function(){valaszAdd(6);};}
if(addSor){addSor.onclick=function(){valaszAdd(7);};}
if(addSor2){addSor2.onclick=function(){valaszAdd(8);};}
if(skala_valaszok_szama){skala_valaszok_szama.onchange=changeSkalaValaszokSzama;}
if(attachment&&attachment_input){attachment.onclick=function(){var eddigi_fajlok=document.getElementsByClassName('attachment_list_elem');if(eddigi_fajlok.length>=maxfilesN){alert(lang['error_max_file_amount']);return false;}
attachment_input.click();};attachment_input.onchange=handle_file;}
if(fcs&&fcs_input){fcs.onclick=function(){document.getElementById('fcs_input').click();};fcs_input.onchange=handle_fcs_source;}
if(document.getElementById('editKerdes')){var inputs=Array.prototype.slice.call(document.getElementById('editKerdes').getElementsByTagName('input'));var textareas=Array.prototype.slice.call(document.getElementById('editKerdes').getElementsByTagName('textarea'));if(textareas.length)inputs.push.apply(inputs,textareas);if(inputs.length){for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('id')!='cimkek')inputs[i].onkeyup=function(){clearTimeout(timer);timer=setTimeout(function(){getCimkeAjanlas('_kerdes');},1500);};}}}
var attachment_close=document.getElementsByClassName('attachment_close');if(attachment_close.length){for(var i=0;i<attachment_close.length;i++){attachment_close[i].onclick=closeAttachmentThing;}}
refreshCimkek();var openErtekeles=document.getElementById("openErtekeles");if(openErtekeles){openErtekeles.onclick=function(){openPopupWindow(lang['evaluation'],7);}}
if(document.getElementById("loadmore")){document.getElementById("loadmore").onclick=function(){loadmore();}}
setupFeladatkep();megosztasSettings();setupObjButtons();setJoValaszSkala();if(document.getElementById("j_thejumpers")){var jumpers=document.getElementById("j_thejumpers").getElementsByTagName("span");for(var i=0;i<jumpers.length;i++){jumpers[i].onclick=function(){gebi("jumpcode").value=this.innerHTML;gebi("jumper_from").submit();};}}}
function redlog(s){if(window.location.href.substr(7,9)=="localhost"){console.log(s);}}
function valaszAdd1(response){valaszAddAjax("valasz_form1",response);}
function valaszAdd2(response){valaszAddAjax("valasz_form2",response);}
function valaszAdd3(response){valaszAddAjax("allitas_form",response);}
function valaszAdd5(response){var t=document.getElementById('egyszavas_table');var asd=t.getElementsByClassName('valasz_opcio');var values=new Array;var percents=new Array;for(var i=0;i<asd.length;i++){values.push(asd[i].getElementsByClassName('valasz_egyszavas')[0].value);percents.push(asd[i].getElementsByClassName('egyszavas_szazalek')[0].value);}
t.innerHTML=t.innerHTML+response;for(var i in values){asd[i].getElementsByClassName('valasz_egyszavas')[0].value=values[i];asd[i].getElementsByClassName('egyszavas_szazalek')[0].value=percents[i];}
refreshSettings();setupDelAnswer();}
function valaszAdd6(response){valaszAddAjax("skala_allitas_form",response);}
function valaszAdd7(response){valaszAddAjax("parositos_form",response);}
function valaszAdd8(response){valaszAddAjax("sorrend_form",response);}
function valaszAddAjax(id,response){var elem=document.createElement("span");elem.innerHTML=response;document.getElementById(id).appendChild(elem);refreshSettings();setupDelAnswer();}
function valaszAdd(formSzam){if(formSzam==1)var formom="valasz_form1";if(formSzam==2)var formom="valasz_form2";if(formSzam==3)var formom="allitas_form";if(formSzam==5)var formom="egyszavas_input";if(formSzam==6)var formom="skala_allitas_form";if(formSzam==7)var formom="parositos_form";if(formSzam==8)var formom="sorrend_form";var sorszam=document.getElementById(formom).getElementsByTagName('div').length+1;if(sorszam<=20){var params={};params['i']=sorszam;params['form']=formSzam;if(formSzam==1)ajax("getFormSablon",params,valaszAdd1);if(formSzam==2)ajax("getFormSablon",params,valaszAdd2);if(formSzam==3)ajax("getFormSablon",params,valaszAdd3);if(formSzam==5)ajax("getFormSablon",params,valaszAdd5);if(formSzam==6)ajax("getFormSablon",params,valaszAdd6);if(formSzam==7)ajax("getFormSablon",params,valaszAdd7);if(formSzam==8)ajax("getFormSablon",params,valaszAdd8);}}
function megosztasSettings(){var elem=document.getElementsByName("mego");for(i=0;i<elem.length;i++){elem[i].onchange=function(){megosztasEll();};}}
function megosztasEll(skipSave){var szint=0;var elem=document.getElementsByName("mego");for(i=0;i<elem.length;i++){if(elem[i].checked)szint=elem[i].value;}
if(szint==4){document.getElementById("anon_div").style.display="block";}else{document.getElementById("anon_div").style.display="none";}
if(!skipSave){megosztasSave();}}
function megosztasSave(){megosztasEll(true);var szint=0;var elem=document.getElementsByName("mego");for(i=0;i<elem.length;i++){if(elem[i].checked)szint=elem[i].value;}
var params={};params['ks_id']=ks_id;params['szint']=szint;ajax("megosztasMent",params,afterMSave);}
function afterMSave(){redalert(lang['saved_successfully']);}
function sikeresMentes(force){redalert(lang['saved_successfully'],force);}
function jogSave(){var jog=document.getElementById("jog-jog").value;var email=document.getElementById("jog-email").value;var params={};params['ks_id']=ks_id;params['jog']=jog;params['email']=email;if(jog.length>0&&email.length>0)ajax("jogMent",params,afterJSave);}
function jogDelete(elem,id){elem.parentNode.parentNode.style.display="none";var params={};params['ks_id']=ks_id;params['uid']=id;ajax("jogDel",params);}
function afterJSave(response){var tr=document.createElement("tr");tr.innerHTML=response;if(document.getElementById("jnincs"))document.getElementById("jnincs").style.display="none";document.getElementById("jbody").appendChild(tr);}
function handle_file(evt){if(!formdata){redalert(lang['old_browser']);return false;}
var file_name="";for(var i=0;i<this.files.length;i++){file_name=this.files[i].name;if(typeof attachments[file_name]!=="undefined"||document.getElementById(file_name)){alert(lang['already_attached_file']);return false;}
file_size=this.files[i].size;if(file_size>1000000){alert(lang['file_is_too_big']);return false;}
document.getElementById('attachment_list').innerHTML=document.getElementById('attachment_list').innerHTML+'<div class="attachment_list_elem" id="'+file_name+'"><a href="javascript:void(0);" class="attachment_close icon-remove on-left"></a> '+file_name+'</div>';attachments[file_name]=this.files[i];}
var attachment_close=document.getElementsByClassName('attachment_close');if(attachment_close.length){for(var i=0;i<attachment_close.length;i++){attachment_close[i].onclick=closeAttachmentThing;}}}
function handle_fcs_source(){if(this.files[0]&&formdata){formdata.append('action','fcsImport');formdata.append('src',this.files[0]);}
ajax_run(formdata,function(response){},"",true,1);}
function setFeladattipus(){document.getElementById('feladattipus').value=this.value;var divs=0;var contents=new Array;var valaszLehet=document.getElementById('valaszlehet');if(this.value==1||this.value==2){if(valaszLehet.getElementsByTagName('div')[0].getAttribute('id')=='valasz_form1'){divs=valaszLehet.getElementsByTagName('input').length;}else if(valaszLehet.getElementsByTagName('div')[0].getAttribute('id')=='valasz_form2'){divs=valaszLehet.getElementsByTagName('input').length;}
divs--;if(divs>0){for(var i=1;i<=divs;i++){contents.push(document.getElementById('valasz'+i).value);}}}
document.getElementById('valaszlehet').innerHTML=document.getElementById('feladattipus'+this.value).innerHTML;if(document.getElementById('szoveg').value==''&&this.value==3)document.getElementById('szoveg').value=lang['true_false_instructions'];else if(document.getElementById('szoveg').value==lang['true_false_instructions']&&this.value!=3)document.getElementById('szoveg').value='';if(divs>0){if(divs>4){var params={};params['i']=5;params['form']=parseInt(valaszLehet.getElementsByTagName('div')[0].getAttribute('id').substr(-1));params['db']=(divs-4);if(valaszLehet.getElementsByTagName('div')[0].getAttribute('id')=='valasz_form1')ajax("getFormSablon",params,valaszAdd1,"",{},1);if(valaszLehet.getElementsByTagName('div')[0].getAttribute('id')=='valasz_form2')ajax("getFormSablon",params,valaszAdd2,"",{},1);}
for(var i=1;i<=divs;i++){document.getElementById('valasz'+i).value=contents[i-1];}}
refreshSettings();setupDelAnswer();good_answers=new Array;}
function ksKereses(only_own){var val=(!only_own)?document.getElementById('ksKereses').value:document.getElementById('cloudkeres').value;if(val==""){if(latestSearchWord){loadmore_counter=-5;var getheader=1;if(only_own){getheader=0;}
loadmore(getheader);}else if(document.getElementById('ajanlott_kerdesek')&&latestSearchWord){document.getElementById('ajanlott_kerdesek').innerHTML="";}
latestSearchWord="";}
if(val==latestSearchWord||val==""){return false;}
var params={};params['q']=val;params['only_own']=only_own;ajax("keresKerdesEgyszeru",params,function(response){json=JSON.parse(response);if(!json.hiba){latestSearchWord=json.q;delete json.q;sKerdesFeltolt(response);refreshKerdesLista();}
else{latestSearchWord=true;document.getElementById('ajanlott_kerdesek').innerHTML="<h6>"+json[0]+"</h6>";if(document.getElementById("loadmore")){document.getElementById("loadmore").style.display="none";}}});}
function loadmore(getheader){getheader=typeof getheader!=='undefined'?getheader:0;loadmore_counter+=5;document.getElementById("loadmore").style.display="block";var params=[];params['start']=loadmore_counter;params['getheader']=getheader;ajax("loadmorefrommyown",params,function(response){if(response!="nomore"){if(loadmore_counter==0){document.getElementById('ajanlott_kerdesek').innerHTML="";}
sKerdesFeltolt(response,1);refreshKerdesLista();}else{document.getElementById("loadmore").style.display="none";}});}
function sKerdesFeltolt(response,addmore){var json=JSON.parse(response);if(!addmore){document.getElementById('ajanlott_kerdesek').innerHTML="";if(document.getElementById("loadmore")){document.getElementById("loadmore").style.display="none";}}
if(json['header']){document.getElementById('ajanlott_kerdesek').innerHTML=json['header'];}
var keresett_kerdesek=new Array;for(var k in json){for(var j in json[k]){if(k=='q'||k=='header')continue;keresett_kerdesek.push(json[k][j]['kid']);var editor=json[k][j]['editor'];var sKerdesDiv=document.createElement('div');sKerdesDiv.setAttribute('class','sKerdes');var sTitle=document.createElement('div');if(editor>0)sTitle.setAttribute('class','sTitle mathquill-embedded-latex');else sTitle.setAttribute('class','sTitle');sKerdesDiv.appendChild(sTitle);var sType=document.createElement('div');sType.setAttribute('class','sType');sKerdesDiv.appendChild(sType);var sCimkek=document.createElement('div');sCimkek.setAttribute('class','sCimkek');sKerdesDiv.appendChild(sCimkek);var s;var cimkelista=json[k][j]['cimkek'];if(cimkelista){for(var l=0;l<cimkelista.length;l++){s=document.createElement('span');sCimkek.appendChild(s);s.innerHTML=cimkelista[l];}}
var span=document.createElement('span');sType.appendChild(span);sKerdesDiv.setAttribute('id',json[k][j]['kid']);sTitle.innerHTML=json[k][j]['szoveg'].split("\\r\\n").join(" ");span.innerHTML=getTipusNev[json[k][j]['tipus']];document.getElementById('ajanlott_kerdesek').appendChild(sKerdesDiv);}}
refreshKerdesListOnclick();setupRedLatex();}
function refreshKerdesListOnclick(){var kerdes_list=document.getElementsByClassName('sKerdes');if(kerdes_list){for(var i=0;i<kerdes_list.length;i++){kerdes_list[i].onclick=function(){feladatCsere(this);};kerdes_list[i].ontouchend=function(){if(!mozdult){feladatCsere(this);}
mozdult=false;};}}
refreshKerdesLista();}
function feladatCsereAction(response){sKerdesBlokkFeltolt(response,'kerdesBlokkTitel','kerdesBlokkValaszok');if(document.getElementById('addToKs')){if(ks_kerdesek.indexOf(akt_kerdes)>-1){document.getElementById('addToKs').style.display="none";document.getElementById('delFromKs').style.display="inline-block";document.getElementById('ksEditPontok').style.display='inline-block';if(editable_tasks.indexOf(akt_kerdes)>-1)document.getElementById('ksEditFeladat').style.display='inline-block';else document.getElementById('ksEditFeladat').style.display='none';}else{document.getElementById('delFromKs').style.display="none";document.getElementById('addToKs').style.display="inline-block";document.getElementById('ksEditPontok').style.display='none';document.getElementById('ksEditFeladat').style.display='none';}}else{if(document.getElementById('DelFeladat'))document.getElementById('DelFeladat').style.display='inline-block';if(document.getElementById('ksEditFeladat'))document.getElementById('ksEditFeladat').style.display='inline-block';}
ks_cache[akt_kerdes]=response;if(ks_kerdesek.indexOf(akt_kerdes)!=-1){getPontSzerkeszto();}
setLeftRightHeight();setupSorrendHeight();}
function feladatCsere(_this){var this_id=_this.getAttribute('id');if(this_id.substr(0,2)=='ks'){this_id=this_id.substr(2);}
akt_kerdes=this_id+"";blockEditPont=1;document.getElementById("ksKerdesManage").style.display="block";if(document.getElementById('editPontok')){document.getElementById('editPontok').style.display='none';}
document.getElementById('kerdesInfo').style.display="block";if(!ks_cache[this_id]){var params={};params['ks_id']=ks_id;params['kid']=this_id;params['szerk']=1;ajax("getKerdesBlokk",params,function(response){feladatCsereAction(response);},"",{},false);}else{feladatCsereAction(ks_cache[this_id]);}
if(document.getElementById('editToScroll'))document.getElementById('editToScroll').scrollIntoView();}
function getPontSzerkeszto(){if(!ks_id)return;if(!ks_pont_cache[akt_kerdes]||ks_pont_cache[akt_kerdes]==''){var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;params['szerk']=2;ajax("getKerdesBlokk",params,function(response){sKerdesBlokkFeltolt(response,'kerdesBlokkTitelPont','kerdesBlokkPontok',1);ks_pont_cache[akt_kerdes]=response;blockEditPont=0;if(forceponteditview){forceponteditview=false;pontEditView();}},"",{},false);}else{sKerdesBlokkFeltolt(ks_pont_cache[akt_kerdes],'kerdesBlokkTitelPont','kerdesBlokkPontok',1);blockEditPont=0;if(forceponteditview){forceponteditview=false;pontEditView();}}}
function sKerdesBlokkFeltolt(response,cimId,vbId,hide){if(!response)return;hide=typeof hide!=='undefined'?hide:0;try{var json=JSON.parse(response);}catch(err){console.log(err);return;}
if((json['mine']==1||json['jog']==1)&&editable_tasks.indexOf(json['kid'])==-1)editable_tasks.push(json['kid']);if(cimId&&vbId){if(document.getElementById('editKerdes'))document.getElementById('editKerdes').style.display="none";if(document.getElementById('kerdesBlokk'))document.getElementById('kerdesBlokk').style.display="block";if(document.getElementById('kerdesBlokkTitel'))document.getElementById('kerdesBlokkTitel').style.display="block";document.getElementById(cimId).innerHTML=json['szoveg'];document.getElementById(vbId).innerHTML=json['valaszBlokk'];if(json['info']&&document.getElementById("kerdesInfo")){document.getElementById("kerdesInfo").innerHTML=json['info'];voteInit();}
if(document.getElementById('addToKs')&&!hide){document.getElementById('addToKs').style.display="none";}}
setupFeladatkep();setupRedLatex();}
function getEditKerdesForm(){selectedCimkek=new Array;var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;ajax("getEditKerdesForm",params,function(response){good_answers=new Array;document.getElementById("editKerdesFelirat").innerHTML=lang['edittask'];document.getElementById('editKerdesInner').innerHTML=response;onnewkerdes=true;afterGetKerdesFormSetDisplays();document.getElementById('valaszlehet').innerHTML=document.getElementById('feladattipus'+document.getElementById('feladattipus').value).innerHTML;document.getElementById('setFeladattipus').value=document.getElementById('feladattipus').value;var t_cimkek=document.getElementById('cimkekGyujto').getElementsByClassName('cimkeAjanlatSpan');for(var i=0;i<t_cimkek.length;i++){selectedCimkek.push(t_cimkek[i].innerHTML);}
var t_cimkek2=document.getElementById('ajanlottCimkek').getElementsByClassName('cimkeAjanlatSpan');if(t_cimkek2.length>0){for(var i=0;i<t_cimkek.length;i++){if(!t_cimkek2[i])continue;if(!inArray(t_cimkek2[i].innerHTML,lastUsedCimkek)){lastUsedCimkek.push(t_cimkek2[i].innerHTML);}}}
if(document.getElementById('good_answers_hid')){var help=document.getElementById('good_answers_hid').value.split('|');for(var i=0;i<help.length;i++){good_answers.push(help[i]);}}
refreshSettings();setupDelAnswer();if(document.getElementById('editToScroll'))document.getElementById('editToScroll').scrollIntoView();});}
function getUjKerdesForm(){selectedCimkek=new Array;var params={};params['ks_id']=ks_id;ajax("getUjKerdesForm",params,function(response){document.getElementById("editKerdesFelirat").innerHTML=lang['newtask'];document.getElementById('editKerdesInner').innerHTML=response;refreshSettings();onnewkerdes=true;afterGetKerdesForm();var t_cimkek=document.getElementById('cimkekGyujto').getElementsByClassName('cimkeAjanlatSpan');for(var i=0;i<t_cimkek.length;i++){selectedCimkek.push(t_cimkek[i].innerHTML);}
var t_cimkek2=document.getElementById('ajanlottCimkek').getElementsByClassName('cimkeAjanlatSpan');if(t_cimkek2.length>0){for(var i=0;i<t_cimkek.length;i++){if(!t_cimkek2[i])continue;if(!inArray(t_cimkek2[i].innerHTML,lastUsedCimkek)){lastUsedCimkek.push(t_cimkek2[i].innerHTML);}}}
if(document.getElementById('editToScroll'))document.getElementById('editToScroll').scrollIntoView();});}
function afterGetKerdesForm(){var inputs=Array.prototype.slice.call(document.getElementById('editKerdes').getElementsByTagName('input'));var selects=Array.prototype.slice.call(document.getElementById('editKerdes').getElementsByTagName('select'));var textareas=Array.prototype.slice.call(document.getElementById('editKerdes').getElementsByTagName('textarea'));if(selects.length)inputs.push.apply(inputs,selects);if(textareas.length)inputs.push.apply(inputs,textareas);for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('type')=="text"||inputs[i].tagName=="TEXTAREA")inputs[i].value="";else if(inputs[i].getAttribute('type')=="number")inputs[i].value=0;else if(inputs[i].tagName=="SELECT")inputs[i].getElementsByTagName('option')[0].setAttribute('selected','selected');}
document.getElementById('valaszlehet').innerHTML=document.getElementById('feladattipus1').innerHTML;document.getElementById('attachment_list').innerHTML='';document.getElementById('attachment_input').value='';attachments=new Array;afterGetKerdesFormSetDisplays();refreshSettings();onnewkerdes=true;good_answers=new Array;}
function afterGetKerdesFormSetDisplays(){if(document.getElementById('kerdesBlokk')){document.getElementById('kerdesBlokk').style.display="none";}
if(document.getElementById('DelFeladat')){document.getElementById('DelFeladat').style.display="none";}
if(document.getElementById('ksEditFeladat')){document.getElementById('ksEditFeladat').style.display="none";}
if(document.getElementById('ksEditPontok')){document.getElementById('ksEditPontok').style.display="none";}
if(document.getElementById('editPontok')){document.getElementById('editPontok').style.display="none";}
if(document.getElementById('editKerdes')){document.getElementById('editKerdes').style.display="block";}
if(document.getElementById('kerdesInfo')){document.getElementById('kerdesInfo').style.display="none";}
meditor_toggle(1);}
function addKerdesToKs(){ks_kerdesek.push(akt_kerdes);if(keresett_kerdesek.indexOf(akt_kerdes)>-1){keresett_kerdesek.splice(keresett_kerdesek.indexOf(akt_kerdes),1);}
var kerdesBox=document.getElementById(akt_kerdes).cloneNode(true);kerdesBox.setAttribute('id','ks'+kerdesBox.getAttribute('id'));document.getElementById('valogatott_kerdesek').appendChild(kerdesBox);document.getElementById('addToKs').style.display="none";document.getElementById('ksEditPontok').style.display='inline-block';document.getElementById('ksEditFeladat').style.display='inline-block';document.getElementById('delFromKs').style.display="inline-block";refreshKerdesListOnclick();getTheTaskAfterSave=true;mentKerdessor();if(document.getElementById('kerdesBlokkTitel').style.display=='block'&&document.getElementById('ksEditPontok').style.display=='none'){document.getElementById('ksEditPontok').style.display='inline-block';document.getElementById('ksEditFeladat').style.display='inline-block';}}
function delKerdesFromKs(){if(ks_kerdesek.indexOf(akt_kerdes)>-1){ks_kerdesek.splice(ks_kerdesek.indexOf(akt_kerdes),1);}
document.getElementById('valogatott_kerdesek').removeChild(document.getElementById('ks'+akt_kerdes));document.getElementById('delFromKs').style.display="none";document.getElementById('ksEditPontok').style.display='none';document.getElementById('ksEditFeladat').style.display='none';document.getElementById('addToKs').style.display="inline-block";ks_pont_cache[akt_kerdes]='';refreshKerdesListOnclick();reloadKsKerdesek();mentKerdessor();if(document.getElementById('kerdesBlokkTitel').style.display=='block'&&document.getElementById('ksEditPontok').style.display=='inline-block'){document.getElementById('ksEditPontok').style.display='none';document.getElementById('ksEditFeladat').style.display='none';}}
function afterMentKerdessor(response){if(getTheTaskAfterSave){forceponteditview=true;getPontSzerkeszto();getTheTaskAfterSave=false;}
var lefutott=false;var frommetaedit=false;if(document.getElementById('delKs')){frommetaedit=true;}
if(document.getElementById('closeKsMeta')){closepopup();document.getElementById('closeKsMeta').style.display="block";lefutott=true;}
if(!ks_id||lefutott){ks_id=parseInt(response.split('|')[1]);if(isNaN(ks_id))return false;if(!frommetaedit)window.location.href="?edit&ks_id="+ks_id+"&newsimple";}
if(document.getElementById('pontokEll')){if(parseInt(response.split('|')[0])){document.getElementById('pontokEll').style.display="block";}else{document.getElementById('pontokEll').style.display="none";}}
if(document.getElementById('utoljaraMentve'))document.getElementById('utoljaraMentve').style.display='block';datumki("idopont");}
function mentKerdessor(meta){meta=typeof meta!=='undefined'?meta:0;if(ks_meta['cim']!=""){var kids=ks_kerdesek.join('|');if(oldaltoresek[oldaltoresek.length-1]==ks_kerdesek.length)oldaltoresek.splice((oldaltoresek.length-1),1);var oldaltores_h=oldaltoresek.join('|');var params=[];params['ks_id']=ks_id;params['kids']=kids;params['cim']=ks_meta['cim'];params['leiras']=ks_meta['leiras'];params['cimkek']=ks_meta['cimkek'];params['oldaltoresek']=oldaltores_h;var cloneKs=document.getElementById('cloneKs');if(cloneKs)params['clone']=document.getElementById('cloneKs').value;else params['clone']=0;var folder=document.getElementById('folderId');if(folder)params['folder']=document.getElementById('folderId').value;if(document.getElementById('lastSaved')){document.getElementById('lastSaved').style.display='block';document.getElementById('utoljaraMentve').style.display='none';document.getElementById('idopont').innerHTML=lang['save'];}
ajax("saveKerdessor",params,afterMentKerdessor,"",{},false);}
else alert(lang['no_title']);}
function saveKsSolvingSettings(_this){var btn=_this.id.substr(0,3);var id=_this.id.substr(4);var ids=id.split('_');ks_id=QueryString.ks_id;if(ks_id!=ids[0]){alert("alma");return false;}
csid=0;if(ids[1]){csid=ids[1];}
var params=[];params['ks_id']=ks_id;params['csid']=csid;params['limit']=document.getElementById("ksLimit_"+id).value;params['attempts']=document.getElementById("ksAttempts_"+id).value;params['time1']=jQuery('#datetimepicker1_'+id).val();params['time2']=jQuery('#datetimepicker2_'+id).val();params['resultsafter']=document.getElementById("ksResultsAfter_"+id).value;params['randomorder']=document.getElementById("ksOrder_"+id).value;ajax("saveKsSolvingSettings",params,function(response){if(btn=="sdl"&&response=="OK"){alert(lang['saved_successfully']);}
afterMentKerdessor(response);});}
function mentGroupMeta(){var name=document.getElementById("groupName").value;if(name.length>1){var params=[];params['csid']=QueryString.csid;params['name']=name;ajax2("mentGrMeta",params,function(res){document.getElementById("grName").innerHTML=res;closepopup();});}}
function mentKsMeta(){if(document.getElementById('ksCim')){if(document.getElementById('ksCim').value!=""){ks_meta['cim']=document.getElementById('ksCim').value;if(document.getElementById("ksName"))document.getElementById("ksName").innerHTML=ks_meta['cim'];ks_meta['cimkek']=selectedCimkekKs.join(',');if(document.getElementById('ksLeiras'))ks_meta['leiras']=document.getElementById('ksLeiras').value;}}else{ks_meta['cim']=st_title;ks_meta['limit']=0;ks_meta['attempts']=1;ks_meta['leiras']=st_desc;ks_meta['cimkek']=selectedCimkekKs.join(',');}
mentKerdessor(1);}
function createUploadPopup(){var upload_popup_content="";var upi=0;for(var key in attachments){if(typeof attachments[key]!="undefined"){if(upi>0){upload_popup_content+='<div class="dgspace">&nbsp;</div>';}
upi++;upload_popup_content+='<h4 class="upfilename">'+key+'</h4>';upload_popup_content+='<div class="dgstate" id="ajax_state_for_'+key+'"><div class="dgb" id="ajax_dgb'+key+'"><div class="dgi" id="ajax_dgi'+key+'"></div></div></div>';}}
if(upi>0){setPopupTitle("Fájlfeltöltés");setPopupWidth(800);setPopupContent(upload_popup_content);openpopup(1);}}
function uploadPictures(new_task,ell,afterFunc){if(!formdata2){alert(lang['old_browser']);return false;}
already_uploaded=new Array;pic_upload_error={};createUploadPopup();for(var key in attachments){if(typeof attachments[key]!="undefined"){if(already_uploaded.indexOf(key)==-1){formdata2=new FormData();formdata2.append('action','uploadPicsOneByOne');formdata2.append('files[]',attachments[key]);ajax_run(formdata2,function(resp){afterPictures(resp,key,new_task,ell,afterFunc)},function(resp){afterPictures(resp,key,new_task,ell,afterFunc)},false,1,key);already_uploaded.push(key);}}}}
function afterPictures(response,key,new_task,ell,afterFunc){var json=JSON.parse(response);if(json.hiba>0){var hibauzenet="";for(var u in json.hibalista){hibauzenet=hibauzenet+pic_upload_error[k][u]+"\n";}
gebi("ajax_state_for_"+key).innerHTML=hibauzenet;}else{uploadedFileProperties[json.values.f2]={};uploadedFileProperties[json.values.f2]['f']=json.values.f;uploadedFileProperties[json.values.f2]['format']=json.values.format;uploadedFileProperties[json.values.f2]['o_f']=json.values.o_f;uploadedFileProperties[json.values.f2]['t']=json.values.t;}
checkStates(new_task,ell,afterFunc);}
function checkStates(new_task,ell,afterFunc){var states=document.getElementsByClassName("dgstate");var n=states.length;var ready=0;for(var i=0,max=n;i<max;i++){if(states[i].hasAttribute("ready")){ready++;}}
if(n==ready){runSaveKerdes(new_task,ell,afterFunc);}}
function mentKerdes(new_task,ell){if(typeof new_task==='undefined')return false;ell=(typeof ell!=='undefined')?ell:false;if(!formdata){alert(lang['old_browser']);return false;}
formdata=new FormData();var afterFunc=1;if(new_task){formdata.append('action','saveKerdes');}else{formdata.append('action','editKerdes');formdata.append('old_kid',document.getElementById('old_kid').value);formdata.append('changeTasks',changeTasks);if(ks_id==0)afterFunc=2;}
if(ell)formdata.append('action','checkKerdesData');formdata.append('ks_id',ks_id);var medit=document.getElementById("medit_load").value;if(medit==1){var f_editor=0;var f_szoveg=str_replace('\\:','',document.getElementById('szoveg').value);}else{var f_editor=1;var f_szoveg=readRedLatex();}
var f_type=document.getElementById('feladattipus');var f_magyarazat=document.getElementById('magyarazat');var f_cimkek=selectedCimkek.join(',');var elem=document.getElementsByName("fmego");for(i=0;i<elem.length;i++){if(elem[i].checked)q_permission=elem[i].value;}
var eddigi_fajlok=document.getElementsByClassName('attachment_list_elem');if(eddigi_fajlok.length>maxfilesN){alert(lang['error_max_file_amount']);return false;}
formdata.append("editor",f_editor);formdata.append("szoveg",f_szoveg);formdata.append(f_type.getAttribute('name'),f_type.value);formdata.append(f_magyarazat.getAttribute('name'),f_magyarazat.value);formdata.append(document.getElementById('cimkek').getAttribute('name'),f_cimkek);formdata.append('q_permission',q_permission);formdata.append('yt_url',document.getElementById("yt_video_input").value);formdata.append('age_min',document.getElementById("age_min").value);formdata.append('age_max',document.getElementById("age_max").value);formdata.append('deletedAttachments',document.getElementById("deletedAttachments").value.substr(0,(document.getElementById("deletedAttachments").value.length-1)));if(f_type.value==1||f_type.value==2)formdata.append('good_answers',good_answers.join('|'));else if(f_type.value==6)formdata.append('allitasValasz',allitasValasz.join('|'));if(f_type.value==5){formdata.append('onlynumbers',document.getElementById("onlynumbers").checked);formdata.append('case_sensitive',document.getElementById("case_sensitive").checked);}
if(new_task||ell){uploadedFileProperties={};uploadPictures(new_task,ell,afterFunc);}
var valaszok=Array.prototype.slice.call(document.getElementById('valaszlehet').getElementsByTagName('input'));var valaszok2=Array.prototype.slice.call(document.getElementById('valaszlehet').getElementsByTagName('select'));var valaszok3=Array.prototype.slice.call(document.getElementById('valaszlehet').getElementsByTagName('textarea'));if(valaszok2.length)valaszok.push.apply(valaszok,valaszok2);if(valaszok3.length)valaszok.push.apply(valaszok,valaszok3);var val;for(var i=0;i<valaszok.length;i++){if((valaszok[i].getAttribute('type')!='radio'||valaszok[i].checked)&&valaszok[i].getAttribute('name')!==null){if(valaszok[i].getAttribute('type')=='checkbox'){val=0;if(valaszok[i].checked){val=1;}
formdata.append(valaszok[i].getAttribute('name'),val);}else{formdata.append(valaszok[i].getAttribute('name'),valaszok[i].value);}}}
checkStates(new_task,ell,afterFunc);}
function runSaveKerdes(new_task,ell,afterFunc){var fileProps=JSON.stringify(uploadedFileProperties);if(new_task||!ell)formdata.append('uploadedFileProperties',fileProps);if(!ell){ajax_run(formdata,((afterFunc==1)?afterSaveKerdes:afterSaveKerdes2),"",true,1);}else{ajax_run(formdata,function(response){if(response!='ok'){if(response=='kidobott'){loggedout();}else{redalert(response,1);}}else saveKerdesOrPopUp();already_in_formdata=new Array;},"",true,1);}}
function afterSaveKerdes(response){if(response.substr(0,1)=='<'){document.getElementById('valogatott_kerdesek').innerHTML=document.getElementById('valogatott_kerdesek').innerHTML+(response.split("\\r\\n").join(" "));refreshKerdesListOnclick();var elemek=document.getElementById('valogatott_kerdesek').getElementsByClassName("sKerdes");var elemek_n=elemek.length;forceponteditview=true;elemek[elemek_n-1].onclick();if(document.getElementById('old_kid')){var list=document.getElementById('valogatott_kerdesek');var newItem=list.lastChild;list.insertBefore(newItem,document.getElementById('ks'+document.getElementById('old_kid').value));list.removeChild(document.getElementById('ks'+document.getElementById('old_kid').value));var list2=document.getElementById("ajanlott_kerdesek");var newItem2=newItem.cloneNode(true);newItem2.id=newItem.id.substr(2);var elemek=list2.getElementsByClassName('sKerdes');for(var i=0;i<elemek.length;i++){if(elemek[i].id==document.getElementById('old_kid').value){list2.insertBefore(newItem2,elemek[i]);list2.removeChild(document.getElementById(document.getElementById('old_kid').value));}}}
refreshKerdesListOnclick();reloadKsKerdesek();refreshKerdesLista();refreshSettings();mentKerdessor();if(!document.getElementById('old_kid')){var asd=document.getElementsByClassName('sKerdes')[document.getElementsByClassName('sKerdes').length-1].getAttribute('id');asd=asd.substr(2,asd.length-2);ks_kerdesek.push(asd);}
dragAndDropInit();closepopup();formdata=new FormData();attachments=new Array;selectedCimkek=new Array;onnewkerdes=false;}else{if(response=='kidobott'){loggedout();}else{redalert(response,1);}}
already_in_formdata=new Array;saving=false;changeTasks=false;}
function afterSaveKerdes2(response){if(response.substr(0,1)=='<'){document.getElementById('ajanlott_kerdesek').innerHTML=document.getElementById('ajanlott_kerdesek').innerHTML+(response.split("\\r\\n").join(" "));refreshKerdesListOnclick();var elemek=document.getElementById('ajanlott_kerdesek').getElementsByClassName("sKerdes");var elemek_n=elemek.length;forceponteditview=true;elemek[elemek_n-1].onclick();if(document.getElementById('old_kid')){var list=document.getElementById('ajanlott_kerdesek');var newItem=list.lastChild;var list2=document.getElementsByClassName('sKerdes');var sorszam=1;for(var i=0;i<list2.length;i++){if(list2[i].getAttribute('id')==document.getElementById('old_kid').value){sorszam=i+1;}}
list.insertBefore(newItem,list.childNodes[sorszam]);list.removeChild(document.getElementById(document.getElementById('old_kid').value));}
refreshKerdesListOnclick();refreshKerdesLista();refreshSettings();closepopup();formdata=new FormData();attachments=new Array;selectedCimkek=new Array;}else{if(response=='kidobott'){loggedout();}else{redalert(response,1);}}
already_in_formdata=new Array;saving=false;changeTasks=false;}
function pontEditView(){if(blockEditPont){return false;}
if(document.getElementById('editPontok').style.display=='none'){document.getElementById('kerdesBlokk').style.display='none';document.getElementById('editPontok').style.display='block';document.getElementById('kerdesInfo').style.display="none";}else{document.getElementById('editPontok').style.display='none';document.getElementById('kerdesBlokk').style.display='block';document.getElementById('kerdesInfo').style.display="block";}
setupRedLatex();return true;}
function addPointBlock(vid){var params={};params['vid']=vid;ajax("getPointBlok",params,function(response){var elem=document.createElement("div");elem.innerHTML=response;document.getElementById('pointBlokk').appendChild(elem);});}
function get_real_grade_text(szazalek){var elems=document.getElementsByClassName("ertekek_tanari");var text="";for(var i=0;i<elems.length;i++){if(szazalek>=parseInt(elems[i].getAttribute("min"))&&szazalek<=parseInt(elems[i].getAttribute("max"))){text=elems[i].innerHTML;}}
return text;}
function toggleEssayPointInputs(kid,hide){var inputs=document.getElementsByTagName("input");var ossz=0;for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('class')){var class_elemek=inputs[i].getAttribute('class').split(' ');if(class_elemek[0]=="pont_szerk"&&parseInt(class_elemek[3])==kid){if(!hide){inputs[i].style.display="inline";document.getElementById("n_"+class_elemek[3]+"_"+class_elemek[1]).style.display="none";}
else{var elem=document.getElementById("n_"+class_elemek[3]+"_"+class_elemek[1]);inputs[i].style.display="none";elem.innerHTML=inputs[i].value;elem.style.display="inline";}
ossz+=parseInt(inputs[i].value);}}}
var max=document.getElementById("max_"+kid).innerHTML;max=parseInt(max);var szazalek=Math.round(ossz/max*100*100)/100;document.getElementById("ossz_"+kid).innerHTML=ossz;if(document.getElementById("szaz_"+kid)){document.getElementById("szaz_"+kid).innerHTML=szazalek;}
var elems=document.getElementsByClassName("p_ossz");var p_all=0;for(var i=0;i<elems.length;i++){p_all+=parseInt(elems[i].innerHTML);}
document.getElementById("p_all").innerHTML=p_all;var p_all2=document.getElementById("p_all2").innerHTML;p_all2=parseInt(p_all2);var p_all3=Math.round(p_all/p_all2*100*100)/100;document.getElementById("p_all3").innerHTML=p_all3;if(document.getElementById("endGradeText")){document.getElementById("endGradeText").innerHTML=get_real_grade_text(p_all3);}
if(!hide){document.getElementById("save_"+kid).style.display="inline";document.getElementById("edit_"+kid).style.display="none";}
else{document.getElementById("save_"+kid).style.display="none";document.getElementById("edit_"+kid).style.display="inline";}}
function saveEgyszavasPoints(_this){var ks_id,kid,vid,attempt,uid,pont;var ajax_help="";var changed=0;var kid=_this.id.split('_')[1];var inputs=_this.parentNode.parentNode.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('class')){var class_elemek=inputs[i].getAttribute('class').split(' ');if(class_elemek[0]=="pont_szerk"&&class_elemek[3]==kid){my_input=inputs[i];}}}
if(typeof my_input==="undefined"){toggleEssayPointInputs(kid,1);return false;}
var class_elemek=my_input.getAttribute('class').split(' ');if(my_input.value=='')my_input.value=0;if(parseInt(my_input.getAttribute("max"))<parseInt(my_input.value)){my_input.value=my_input.getAttribute("max");}
if(parseInt(my_input.getAttribute("min"))>parseInt(my_input.value)){my_input.value=my_input.getAttribute("min");}
if(document.getElementById("n_"+class_elemek[3]+"_"+class_elemek[1]).innerHTML!=my_input.value){changed++;}
if(vid){if(vid!=parseInt(class_elemek[2])||kid!=parseInt(class_elemek[3])||ks_id!=parseInt(class_elemek[4])||attempt!=parseInt(class_elemek[5])||uid!=parseInt(class_elemek[6]))return false;}
vid=parseInt(class_elemek[2]);kid=parseInt(class_elemek[3]);ks_id=parseInt(class_elemek[4]);attempt=parseInt(class_elemek[5]);uid=parseInt(class_elemek[6]);pont=my_input.value;if(changed==0){toggleEssayPointInputs(kid,1);return false;}
var params={};params['ks_id']=ks_id;params['kid']=kid;params['vid']=vid;params['attempt']=attempt;params['uid']=uid;params['pont']=pont;ajax("saveEgyszavasPontokAjax",params,function(response){toggleEssayPointInputs(response,1);},"",ajax_help);}
function saveEssayAnswerPoints(_this){var inputs=_this.parentNode.parentNode.getElementsByTagName("input");var pontok=new Array;var pids=new Array;var ks_id,kid,vid,attempt,uid;var ajax_help="";var changed=0;for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('class')){var class_elemek=inputs[i].getAttribute('class').split(' ');if(class_elemek[0]=="pont_szerk"){if(inputs[i].value=='')inputs[i].value=0;if(parseInt(inputs[i].getAttribute("max"))<parseInt(inputs[i].value)){inputs[i].value=inputs[i].getAttribute("max");}
if(parseInt(inputs[i].getAttribute("min"))>parseInt(inputs[i].value)){inputs[i].value=inputs[i].getAttribute("min");}
if(document.getElementById("n_"+class_elemek[3]+"_"+class_elemek[1]).innerHTML!=inputs[i].value){changed++;}
pontok.push(parseInt(inputs[i].value));pids.push(parseInt(class_elemek[1]));if(vid){if(vid!=parseInt(class_elemek[2])||kid!=parseInt(class_elemek[3])||ks_id!=parseInt(class_elemek[4])||attempt!=parseInt(class_elemek[5])||uid!=parseInt(class_elemek[6]))return false;}
vid=parseInt(class_elemek[2]);kid=parseInt(class_elemek[3]);ks_id=parseInt(class_elemek[4]);attempt=parseInt(class_elemek[5]);uid=parseInt(class_elemek[6]);}}}
if(pontok.length!=pids.length){alert(lang['no_data']);return false;}
if(changed==0){toggleEssayPointInputs(kid,1);return false;}
var params={};params['ks_id']=ks_id;params['kid']=kid;params['vid']=vid;params['attempt']=attempt;params['uid']=uid;for(var j=0;j<pontok.length;j++){params['p'+j]=pontok[j];params['pid'+j]=pids[j];}
ajax("saveEssayPontok",params,function(response){toggleEssayPointInputs(response,1);},"",ajax_help);}
function mentPontok(){if(document.getElementById('max_point_value_szerk')){var max_point_value_szerk=document.getElementById('max_point_value_szerk').value;var max_answer_szerk=document.getElementById('max_answer_szerk').value;var ertekelesTipusa=document.getElementById('ertekelesTipusa').value;var meheteNullaAlaSzerk=document.getElementById('meheteNullaAlaSzerk').value;var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;var ajax_help="&max_point_value="+max_point_value_szerk+"&max_answer="+max_answer_szerk+"&ertekelesTipusa="+ertekelesTipusa+"&meheteNullaAla="+meheteNullaAlaSzerk;ajax2("savePontokMultipleChoice",params,function(response){if(response=='ok'){document.getElementById("editPontok").style.display="none";document.getElementById('kerdesInfo').style.display="block";ks_pont_cache[akt_kerdes]='';feladatCsereAction(ks_cache[akt_kerdes]);if(document.getElementById('pontokEll')){if(parseInt(response.split('|')[0])){document.getElementById('pontokEll').style.display="block";}else{document.getElementById('pontokEll').style.display="none";}}}else alert(response);},ajax_help,true);}else if(document.getElementById('good_option')){var good_option=document.getElementById('good_option').value;var wrong_option=document.getElementById('wrong_option').value;var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;var ajax_help="&good_option="+good_option+"&wrong_option="+wrong_option;ajax2("savePontokParositos",params,function(response){if(response=='ok'){document.getElementById("editPontok").style.display="none";document.getElementById('kerdesInfo').style.display="block";ks_pont_cache[akt_kerdes]='';feladatCsereAction(ks_cache[akt_kerdes]);if(document.getElementById('pontokEll')){if(parseInt(response.split('|')[0])){document.getElementById('pontokEll').style.display="block";}else{document.getElementById('pontokEll').style.display="none";}}}else alert(response);},ajax_help,true);}else if(document.getElementById('max_point')){var max_point=document.getElementById('max_point').value;var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;var ajax_help="&max_point="+max_point;ajax2("savePontokSorrend",params,function(response){if(response=='ok'){document.getElementById("editPontok").style.display="none";document.getElementById('kerdesInfo').style.display="block";ks_pont_cache[akt_kerdes]='';feladatCsereAction(ks_cache[akt_kerdes]);if(document.getElementById('pontokEll')){if(parseInt(response.split('|')[0])){document.getElementById('pontokEll').style.display="block";}else{document.getElementById('pontokEll').style.display="none";}}}else alert(response);},ajax_help,true);}else{var inputs=document.getElementsByTagName("input");var pontok=new Array;var vids=new Array;var szemp=new Array;var ajax_help="";for(var i=0;i<inputs.length;i++){if(inputs[i].getAttribute('class')){var class_elemek=inputs[i].getAttribute('class').split(' ');if(class_elemek[0]=="pont_szerk"){if(inputs[i].value=='')inputs[i].value=0;pontok.push(parseInt(inputs[i].value));vids.push(parseInt(class_elemek[1]));}
else if(class_elemek[0]=="szemp_szerk"){var text=inputs[i].value.trim();if(text)szemp.push(text);}}}
if(pontok.length!=vids.length){alert(lang['no_data']);return false;}
if(szemp.length){if(pontok.length!=szemp.length){alert(lang['no_data']);return false;}}
for(var j=0;j<pontok.length;j++){ajax_help=ajax_help+'&p'+j+'='+pontok[j]+'&vid'+j+'='+vids[j];if(szemp[j])ajax_help+='&szemp'+j+'='+szemp[j];}
ajax_help=ajax_help.substr(1);var params={};params['ks_id']=ks_id;params['kid']=akt_kerdes;ajax2("savePontok",params,function(response){document.getElementById("editPontok").style.display="none";document.getElementById('kerdesInfo').style.display="block";ks_pont_cache[akt_kerdes]='';feladatCsereAction(ks_cache[akt_kerdes]);if(document.getElementById('pontokEll')){if(parseInt(response.split('|')[0])){document.getElementById('pontokEll').style.display="block";}else{document.getElementById('pontokEll').style.display="none";}}},ajax_help,true);}}
function setAsJoValasz(){var thisId=this.getAttribute('id').substr(-3,3);if(!document.getElementById('asJoValaszSimpleMegse'+thisId)){var thisId=this.getAttribute('id').substr(-2,2);}
if(!document.getElementById('asJoValaszSimpleMegse'+thisId)){var thisId=this.getAttribute('id').substr(-1,1);}
for(var i=0;i<document.getElementsByClassName('selectJoValasz').length;i++){document.getElementsByClassName('selectJoValasz')[i].style.display='inline-block';document.getElementsByClassName('selectJoValaszSimpleMegse')[i].style.display='none';}
var megse=document.getElementById('asJoValaszSimpleMegse'+thisId);this.style.display="none";megse.style.display='inline-block';good_answers=new Array;good_answers.push(thisId);}
function setAsJoValaszMultiple(){var thisId=this.getAttribute('id').substr(-3,3);if(!document.getElementById('asJoValasz'+thisId)){var thisId=this.getAttribute('id').substr(-2,2);}
if(!document.getElementById('asJoValasz'+thisId)){var thisId=this.getAttribute('id').substr(-1,1);}
document.getElementById('asJoValasz'+thisId).style.display="none";document.getElementById('asJoValaszMegse'+thisId).style.display="inline";good_answers.push(thisId);}
function setJoValaszSkala(){if(!document.getElementById('setFeladattipus'))return false;allitasValasz=new Array();if(document.getElementById('setFeladattipus').value!=6){allitasValasz=[5,5,5,5,5];}else{var a=document.getElementById('valaszlehet').getElementsByClassName('skala_good_answer');for(var i=0;i<a.length;i++){allitasValasz.push(a[i].value);}}}
function setAsJoValaszMultipleCancel(){var thisId=this.getAttribute('id').substr(-3,3);if(!document.getElementById('asJoValasz'+thisId)){var thisId=this.getAttribute('id').substr(-2,2);}
if(!document.getElementById('asJoValasz'+thisId)){var thisId=this.getAttribute('id').substr(-1,1);}
document.getElementById('asJoValaszMegse'+thisId).style.display="none";document.getElementById('asJoValasz'+thisId).style.display="inline";good_answers.splice(good_answers.indexOf(thisId),1);}
function setErtekelesTipusa(){var val=this.value||document.getElementById('ertekelesTipusa').value;if(val==2){if(document.getElementById('haHibatlan'))document.getElementById('haHibatlan').style.display="none";}else{if(document.getElementById('haHibatlan'))document.getElementById('haHibatlan').style.display="block";}}
function ajax_run(postdata,ifOk,ifNotOk,szinkron,noheader,statekey){last_postdata=postdata;startload();var xhr=new XMLHttpRequest();xhr.id="progress_"+Math.floor((Math.random()*100000));if(statekey){xhr.upload.onprogress=function(e){var percent=Math.floor((e.loaded/e.total)*100);if(gebi("ajax_dgi"+statekey)){gebi("ajax_dgi"+statekey).style.width=percent+"%";gebi("ajax_dgi"+statekey).innerHTML=percent+"%";}
redlog("upload: "+percent+"%");};}
xhr.onreadystatechange=function(e){if(this.readyState==4){redlog("AJAX response: "+this.responseText);last_response="";if(this.responseText!=""){var response=this.responseText;if(response=="kidobott"){loggedout();}else{if(response.substr(0,4)!='hiba'&&response.substr(0,5)!='error'){if(statekey&&gebi("ajax_state_for_"+statekey)){gebi("ajax_state_for_"+statekey).setAttribute("ready","1");}
if(ifOk!="")ifOk(response);last_response=response;}else{if(ifNotOk!="")ifNotOk(response);else if(statekey&&gebi("ajax_state_for_"+statekey)){if(response.length>4)
gebi("ajax_state_for_"+statekey).innerHTML=response;else
gebi("ajax_state_for_"+statekey).innerHTML=lang['error'];}
else if(response.length>4)alert(response);else alert(lang['error']);}}}
else if(statekey&&gebi("ajax_state_for_"+statekey)){gebi("ajax_state_for_"+statekey).innerHTML=lang['error'];}else alert(lang['error']);endload();}};redlog("AJAX send, postdata: "+postdata);if(!szinkron){xhr.open("POST","ajax.php",true);}
else{xhr.open("POST","ajax.php",false);}
if(!noheader){xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");}
xhr.send(postdata);}
function ajax(action,params,ifOk,ifNotOk,extraparam,szinkron){ifOk=typeof ifOk!=='undefined'?ifOk:"";ifNotOk=typeof ifNotOk!=='undefined'?ifNotOk:"";var paramslist="";for(var key in params){if(key==='length'||!params.hasOwnProperty(key))continue;paramslist+="&"+key+"="+params[key];}
if(extraparam&&extraparam.length)paramslist+="&"+extraparam;var postdata="action="+action+paramslist;ajax_run(postdata,ifOk,ifNotOk,szinkron);}
function startload(){onloading=true;loading=setTimeout(function(){viewload()},400);}
function viewload(){clearTimeout(loading);if(onloading)document.getElementById("loading").style.display="block";onloading=false;}
function endload(){clearTimeout(loading);onloading=false;document.getElementById("loading").style.display="none";}
function szolimitSzerk(){if(document.getElementById('szolimit_settings')){if(document.getElementById('van_szolimit').checked){document.getElementById('szolimit_settings').style.display="block";}else if(document.getElementById('nincs_szolimit').checked){document.getElementById('szolimit_settings').style.display="none";document.getElementById('szolimit').value=200;document.getElementById('elteres_szazalek').value=10;document.getElementById('szolimit_demo').innerHTML='180-220';}}}
function egyszavasSzerk(){if(document.getElementById('van_valasz').checked){document.getElementById('egyszavas_input').style.display="block";document.getElementById('case_sensitive_div').style.display="block";}else if(document.getElementById('nincs_valasz').checked){document.getElementById('egyszavas_input').style.display="none";document.getElementById('case_sensitive_div').style.display="none";if(document.getElementById('valasz_egyszavas'))document.getElementById('valasz_egyszavas').value="";}}
function setLimitDemo(){var szlimit=document.getElementById('szolimit').value;var szazalek=parseInt(document.getElementById('elteres_szazalek').value)||0;var minlimit=Math.round(szlimit*(100-szazalek)/100);var maxlimit=Math.round(szlimit*(100+szazalek)/100);document.getElementById('szolimit_demo').innerHTML=minlimit+'-'+maxlimit;}
function refreshCimkek(){var ajanlottCimkek=document.getElementsByClassName('cimkeAjanlatSpan');var cimkeInput=document.getElementById('cimkek');if(ajanlottCimkek.length){for(var i=0;i<ajanlottCimkek.length;i++){ajanlottCimkek[i].onclick=cimkeToKerdesCimkekOrBack;}}
if(cimkeInput)cimkeInput.onkeydown=function(){if(cimkeInput.value.length<1)keyEvent(removeLastCimke,8);if(cimkeInput.value.substr(-1,1)==','||cimkeInput.value.substr(-1,1)==';'){cimkeInput.value=cimkeInput.value.substr(0,cimkeInput.value.length-1);createCimkeSpan('cimkek');}};}
function getCimkeAjanlas(mode){if(typeof mode==='undefined'||(mode!='_ks'&&mode!='_kerdes'))return false;mode=mode;var sz="";if(mode=='_kerdes'){if(!document.getElementById('szoveg'))return false;sz=document.getElementById('szoveg').value+' '+document.getElementById('magyarazat').value;var valaszlehet=document.getElementById('valaszlehet').getElementsByTagName('input');for(var i=0;i<valaszlehet.length;i++){if(valaszlehet[i].getAttribute('type')=='text'){var vvtext=valaszlehet[i].value.trim();if(vvtext.length>0){sz=sz+' '+vvtext;}}}
if(sz.trim().length<=2){return false;}
if(lastAjanlo==sz.trim()){return false;}
lastAjanlo=sz.trim();ajax('cimkeAjanl',{'sz':sz,'mode':mode},function(response){var json=JSON.parse(response);document.getElementById('noCimke').style.display='none';document.getElementById('ajanlottCimkek').innerHTML='';for(var o in lastUsedCimkek){var span=document.createElement('span');span.setAttribute('class','cimkeAjanlatSpan');span.innerHTML=lastUsedCimkek[o];if(!inArray(span.innerHTML,selectedCimkek)){document.getElementById('ajanlottCimkek').appendChild(span);}}
if(json.length){for(var i=0;i<json.length;i++){var span=document.createElement('span');span.setAttribute('class','cimkeAjanlatSpan');span.innerHTML=json[i];if(!inArray(span.innerHTML,selectedCimkek)&&!inArray(span.innerHTML,lastUsedCimkek)){document.getElementById('ajanlottCimkek').appendChild(span);}}}
if(document.getElementById('ajanlottCimkek').innerHTML==""){document.getElementById('noCimke').style.display='block';}
refreshCimkek();});}else if(mode=='_ks'){if(!document.getElementById('ksCim'))return false;sz=document.getElementById('ksCim').value+' '+document.getElementById('ksLeiras').value;if(sz.trim().length<=2){return false;}
if(lastAjanlo==sz.trim()){return false;}
lastAjanlo=sz.trim();ajax('cimkeAjanl',{'sz':sz,'mode':mode},function(response){var json=JSON.parse(response);if(document.getElementById('ajanlottCimkekKs')){document.getElementById('ajanlottCimkekKs').innerHTML='';}else{return false;}
if(document.getElementById('noCimkeKs')){document.getElementById('noCimkeKs').style.display='none';}
for(var o in lastUsedCimkekKs){var span=document.createElement('span');span.setAttribute('class','cimkeAjanlatSpanKs');span.innerHTML=lastUsedCimkekKs[o];if(!inArray(span.innerHTML,selectedCimkekKs)){document.getElementById('ajanlottCimkekKs').appendChild(span);}}
if(json.length){for(var i=0;i<json.length;i++){var span=document.createElement('span');span.setAttribute('class','cimkeAjanlatSpanKs');span.innerHTML=json[i];if(!inArray(span.innerHTML,selectedCimkekKs)){document.getElementById('ajanlottCimkekKs').appendChild(span);}}}
if(document.getElementById('ajanlottCimkekKs').innerHTML==""){document.getElementById('noCimkeKs').style.display='block';}
refreshCimkekKs();});}}
function cimkeToKerdesCimkekOrBack(){var parentId=this.parentNode.getAttribute('id');var cimke=this.cloneNode(true);var parent=this.parentNode;this.parentNode.removeChild(this);if(parentId=='ajanlottCimkek'){selectedCimkek.push(cimke.innerHTML);document.getElementById('cimkekGyujto').appendChild(cimke);if(!parent.getElementsByTagName('span').length)document.getElementById('noCimke').style.display='block';}else if(parentId=='cimkekGyujto'){selectedCimkek.splice(selectedCimkek.indexOf(cimke.innerHTML),1);document.getElementById('noCimke').style.display='none';document.getElementById('ajanlottCimkek').appendChild(cimke);}
refreshCimkek();}
function removeLastCimke(){var ajanlottCimkek=document.getElementsByClassName('cimkeAjanlatSpan');var cimke=ajanlottCimkek[ajanlottCimkek.length-1];if(!cimke)return false;cimke.parentNode.removeChild(cimke);selectedCimkek.splice(selectedCimkek.indexOf(cimke.innerHTML),1);document.getElementById('noCimke').style.display='none';document.getElementById('ajanlottCimkek').appendChild(cimke);refreshCimkek();}
function createCimkeSpan(type){var val="";if(type!='cimkek'&&type!='cimkekKs'){var elem=this;type=this.getAttribute('id');}else{var elem=document.getElementById(type);}
val=elem.value;if(val.substr(-1)==','||val.substr(-1)==';')val=val.substr(0,val.length-1);val=val.trim();if(val.length<3){return false;}
if((type=='cimkek'&&inArray(val,selectedCimkek))||(type=='cimkekKs'&&inArray(val,selectedCimkekKs))){return false;}
var span=document.createElement('span');span.innerHTML=val;if(type=='cimkek'){span.setAttribute('class','cimkeAjanlatSpan');selectedCimkek.push(span.innerHTML);document.getElementById('cimkekGyujto').appendChild(span);refreshCimkek();}else if(type=='cimkekKs'){span.setAttribute('class','cimkeAjanlatSpanKs');selectedCimkekKs.push(span.innerHTML);document.getElementById('cimkekGyujtoKs').appendChild(span);refreshCimkekKs();}
elem.value="";}
function refreshCimkekKs(){var cimkeInput=document.getElementById('cimkekKs');var ajanlottCimkek=document.getElementsByClassName('cimkeAjanlatSpanKs');if(ajanlottCimkek.length){for(var i=0;i<ajanlottCimkek.length;i++){ajanlottCimkek[i].onclick=cimkeToKsCimkekOrBack;}}
if(cimkeInput)cimkeInput.onkeydown=function(){if(cimkeInput.value.length<1)keyEvent(removeLastCimkeKs,8);if(cimkeInput.value.substr(-1,1)==','||cimkeInput.value.substr(-1,1)==';'){cimkeInput.value=cimkeInput.value.substr(0,cimkeInput.value.length-1);createCimkeSpan('cimkekKs');}};}
function cimkeToKsCimkekOrBack(){var parentId=this.parentNode.getAttribute('id');var cimke=this.cloneNode(true);var parent=this.parentNode;this.parentNode.removeChild(this);if(parentId=='ajanlottCimkekKs'){selectedCimkekKs.push(cimke.innerHTML);document.getElementById('cimkekGyujtoKs').appendChild(cimke);if(!parent.getElementsByTagName('span').length)document.getElementById('noCimkeKs').style.display='block';}else if(parentId=='cimkekGyujtoKs'){selectedCimkekKs.splice(selectedCimkekKs.indexOf(cimke.innerHTML),1);document.getElementById('noCimkeKs').style.display='none';document.getElementById('ajanlottCimkekKs').appendChild(cimke);}
refreshCimkekKs();}
function removeLastCimkeKs(){var ajanlottCimkek=document.getElementsByClassName('cimkeAjanlatSpanKs');var cimke=ajanlottCimkek[ajanlottCimkek.length-1];if(!cimke)return false;cimke.parentNode.removeChild(cimke);selectedCimkekKs.splice(selectedCimkekKs.indexOf(cimke.innerHTML),1);document.getElementById('noCimkeKs').style.display='none';document.getElementById('ajanlottCimkekKs').appendChild(cimke);refreshCimkekKs();}
function openNewGroupBox(){openPopupWindow(lang['newgroup'],12);}
function ujKs(){openPopupWindow(lang['new_testsheet'],1,undefined,QueryString.folder);}
function openKsMetaBox(){openPopupWindow(lang['edit_testsheet'],2);}
function openKsMetaBox2(extra){openPopupWindow(lang['edit_dates'],11,450,extra);}
function meghivasPopup(){openPopupWindow(lang['edit_invites'],3,500);}
function openToFolder(){openPopupWindow(lang['tofolder'],20);}
function openEditFolders(){openPopupWindow(lang['edit_folders'],20,undefined,'edit');}
function openToEmbed(){openPopupWindow(lang['embeding'],21,600);}
function setKsMetaBox(response){selectedCimkekKs=new Array;popupUpload(response);document.getElementById('ksCim').value=ks_meta['cim'];document.getElementById('ksLeiras').value=ks_meta['leiras'];var cimkekDivKs=document.getElementById('cimkekDivKs');var cimkekKs=document.getElementById('cimkekKs');var inputs=new Array(document.getElementById('ksCim'),document.getElementById('ksLeiras'));if(cimkekDivKs){cimkekDivKs.onclick=function(){document.getElementById('cimkekKs').focus();};}
if(cimkekKs){cimkekKs.onchange=createCimkeSpan;}
if(gebi("cimkekGyujtoKs")){var labels=gebi("cimkekGyujtoKs").getElementsByClassName("cimkeAjanlatSpanKs");for(var i=0,max=labels.length;i<max;i++){if(!inArray(labels[i].innerHTML,selectedCimkekKs)){selectedCimkekKs.push(labels[i].innerHTML);}}
var labels2=gebi("ajanlottCimkekKs").getElementsByClassName("cimkeAjanlatSpanKs");for(var i=0,max2=labels2.length;i<max2;i++){if(!inArray(labels2[i].innerHTML,lastUsedCimkekKs)){lastUsedCimkekKs.push(labels2[i].innerHTML);}}}
lastAjanlo="";getCimkeAjanlas('_ks');if(inputs[0]&&inputs[1]){inputs[0].onkeyup=function(){clearTimeout(timer);timer=setTimeout(function(){getCimkeAjanlas('_ks');},1500);};inputs[1].onkeyup=function(){clearTimeout(timer);timer=setTimeout(function(){getCimkeAjanlas('_ks');},1500);};}
refreshCimkekKs();}
function setNextPont(){validatePoints();var elems=document.getElementsByClassName("point_limit");for(x in elems){if(x<elems.length-1){var regiid=parseInt(elems[x].id.split('_')[1]);var newid=parseInt(x)+1;document.getElementById("p1_"+regiid).id="p1_"+newid;document.getElementById("p2_"+regiid).id="p2_"+newid;document.getElementById("p3_"+regiid).id="p3_"+newid;document.getElementById("p4_"+regiid).id="p4_"+newid;document.getElementById("p5_"+regiid).id="p5_"+newid;}}
for(x in elems){if(x<elems.length-1){var id=parseInt(elems[x].id.split('_')[1])+1;if(id==elems.length){id=0;}
var ertek="X";if(elems[x].value){ertek=parseInt(elems[x].value)-1;if(ertek<0){ertek=0;}}
document.getElementById("p2_"+id).innerHTML=ertek;}}}
function validatePoints(){var elems=document.getElementsByClassName("point_limit");var elozo;for(x in elems){if(x>0){if(parseInt(elems[x].value)>=elozo){elems[x].value=0;}}else{if(parseInt(elems[x].value)>=100){elems[x].value=0;}}
if(parseInt(elems[x].value)!=elems[x].value){elems[x].value="";}
if(elems[x].value=="00"){elems[x].value=0;}
if(elems[x].value>0){elozo=parseInt(elems[x].value);}}}
function setPonthatarPopup(response){popupUpload(response);refreshPonthatarPopup();}
function refreshPonthatarPopup(){var elems=document.getElementsByClassName("point_limit");for(x in elems){elems[x].onkeyup=function(){clearTimeout(t);t=setTimeout(function(){setNextPont();},5000);};elems[x].onchange=function(){setNextPont();};}}
function oldaltoresBeszur(){var ok=1;for(var i=0;i<oldaltoresek.length;i++){if(oldaltoresek[i]==ks_kerdesek.length){ok=0;}}
if(!ok)return false;oldaltoresek.push(ks_kerdesek.length);var oldaltores=document.createElement('div');oldaltores.setAttribute('class','oldaltores');oldaltores.innerHTML=lang['page_break'];document.getElementById('valogatott_kerdesek').appendChild(oldaltores);var span=document.createElement('span');span.setAttribute('class','oldaltoresExit');span.innerHTML='X';oldaltores.appendChild(span);reloadKsKerdesek();dragAndDropInit();}
function oldaltoresDel(){var ot=document.getElementById('valogatott_kerdesek').getElementsByClassName('oldaltores');for(var i=0;i<ot.length;i++){if(ot[i].getElementsByClassName('oldaltoresExit')[0].style.display=='block'){oldaltoresek.splice(i,1);this.parentNode.parentNode.removeChild(this.parentNode);mentKerdessor();break;}}}
function saveJumper(){var jumperCode=document.getElementById("jumperCode").value;if(jumperCode.length>2&&jumperCode.length<=30){var params={};params['ks_id']=ks_id;params['code']=jumperCode;ajax("saveJumper",params,function(){document.getElementById("copyShareInput").value="https://redmenta.com/"+jumperCode;sikeresMentes();},function(error){redalert('<h1><span class="icon-warning"></span></h1>'+error,1);});}}
function openPonthatarEditor(){openPopupWindow(lang['edit_point_limit'],4);}
function keyEvent(func,code){if(typeof func==='undefined'||typeof code==='undefined')return false;var keyCode;if(window.event){keyCode=window.event.keyCode;}
if(keyCode==code){func();}}
function oldaltoresMouseOver(){this.getElementsByClassName('oldaltoresExit')[0].style.display='block';this.getElementsByClassName('oldaltoresExit')[0].onclick=oldaltoresDel;}
function oldaltoresMouseOut(){this.getElementsByClassName('oldaltoresExit')[0].style.display='none';this.removeEventListener('click',oldaltoresDel);}
function resize(){if(window.innerHeight){hh=window.innerHeight;ww=window.innerWidth;}else if(document.body.clientHeight){hh=document.body.clientHeight;ww=document.body.clientWidth;}else if(document.documentElement.clientHeight){hh=document.documentElement.clientHeight;ww=document.documentElement.clientWidth;}else{alert("Your browser is too old");return;}
setPopupSize();if(!document.getElementById("redmenta"))return;if(ww<=800){if(document.getElementById("jobb")){var mm=document.getElementById("jobb").offsetTop+document.getElementById("jobb").offsetHeight;mm+=200;var pb=hh-mm;if(pb>0)document.getElementById("jobb").style.paddingBottom=pb+"px";}}
var minus=45;if(ww<=800)minus=315;if(document.getElementById("betab")){document.getElementById("betab").style.height=(hh-minus)+"px";if(document.getElementById("betab").offsetHeight<document.getElementById("betacim").offsetHeight){document.getElementById("betab").style.height=(document.getElementById("betacim").offsetHeight+30)+"px";}}
if(gebi("fooldal1")){var w2=ww;if(w2<999)w2=999;var lineap=0;if(ww<=800)lineap=315;var f1h=675;var f1w=512+((w2-1000)/2);gebi("fooldal_o").style.height=f1h+"px";if(ww>960){gebi("fooldal_m").style.backgroundPositionY="-"+((ww-960)/3.1)+"px";}else{gebi("fooldal_m").style.backgroundPositionY="0px";}
if(f1h<gebi("fooldal1").offsetHeight||ww<920)f1h=gebi("fooldal1").offsetHeight;gebi("fooldal2").style.top=(f1h+lineap)+"px";gebi("fooldal3").style.top=(f1h+lineap+gebi("fooldal2").offsetHeight)+"px";var footh=372/1366*w2-10;if(ww<=800)footh=0;gebi("footer_l").style.top=(f1h+lineap+gebi("fooldal2").offsetHeight+gebi("fooldal3").offsetHeight)+"px";gebi("footer_l").style.height=footh+"px";gebi("fooldal_m").style.height=(f1h+310+356+footh)+"px";gebi("fooldal_inner").style.height=(f1h+lineap+310+356+footh-64)+"px";var videow=225/1366*w2;var videoh=144/1366*w2;var videol=413/1366*w2;var videot=402/1366*w2+45;gebi("video_k").style.width=videow+"px";gebi("video_k").style.height=videoh+"px";gebi("video_k").style.left=videol+"px";gebi("video_k").style.top=videot+"px";var h3=hh-60;var videow=560/315*h3;var videol=(w2-videow)/2;if(ww<1230)var fontsize=10;else var fontsize=13;var font1="26pt";var font2="37pt";if(ww<1050){font1="20pt";font2="24pt";}
if(ww<900){font1="15pt";font2="20pt";}
gebi("contact").style.fontSize=font1;gebi("email").style.fontSize=font2;}}
function idozit(){for(var x=0;x<idozittomb.length;x++){idozittomb[x][1]-=1000;idozittomb[x][2].setTime(idozittomb[x][1]);var o=idozittomb[x][2].getHours();var p=idozittomb[x][2].getMinutes();var mp=idozittomb[x][2].getSeconds();var perc=(p<10)?"0"+p:p;var masodperc=(mp<10)?"0"+mp:mp;if(o=="23"&&p=="59"&&mp=="59"){idozittomb[x][0].innerHTML="0:00:0?";if(idozittomb[x][3]=="ksKitIdolimit")ksLejart();}
else{if(o=="23"&&p=="59"&&parseFloat(mp)>10){idozittomb[x][0].innerHTML="0:00:0?";}
else{idozittomb[x][0].innerHTML=o+":"+perc+":"+masodperc;}}}}
function mentPointLimit(){var point_limit=document.getElementsByClassName('point_limit');var grade=document.getElementsByClassName('grade-input');var percents='';var grades='';var firstpont=false;var lastpont=false;for(var i=0;i<point_limit.length;i++){if(grade[i].value&&point_limit[i].value){grades=grades+grade[i].value+'|';percents=percents+point_limit[i].value+'|';if(i==0)firstpont=true;if(i==point_limit.length-1)lastpont=true;}}
if(!firstpont||!lastpont){alert(lang['tworating']);return false;}
grades=grades.substr(0,grades.length-1);percents=percents.substr(0,percents.length-1);redlog(percents+" és "+grades);var params={'percents':percents,'grades':grades,'ks_id':ks_id};ajax("savePointLimit",params,function(){closepopup();});}
function addPercent(){var adatok={};adatok['n']=document.getElementsByClassName("point_limit").length;ajax("getPontHatarSablon",adatok,function(response){var elem=document.createElement("tr");var id=document.getElementsByClassName("point_limit").length;elem.id="p4_"+id;elem.innerHTML=response;document.getElementById('percents').appendChild(elem);smartTestsheetSettings();$.Metro.initInputs();redPopupAutoResize();var temp=document.getElementById("p4_"+id).innerHTML;document.getElementById("p4_"+id).innerHTML=document.getElementById("p4_0").innerHTML;document.getElementById("p4_0").innerHTML=temp;document.getElementById("p4_0").id="p4_temp";document.getElementById("p4_"+id).id="p4_0";document.getElementById("p4_temp").id="p4_"+id;refreshPopupSettings();refreshPonthatarPopup();setNextPont();});}
function percentDel(_this){if(document.getElementsByClassName('grade-input').length<=2)return false;var id=parseInt(_this.id.split('_')[1]);if(id==0||id==1)return false;var elem=document.getElementById("p4_"+id);elem.parentNode.removeChild(elem);$.Metro.initInputs();redPopupAutoResize();smartTestsheetSettings();setNextPont();return true;}
function createSmartTs(){st_title=document.getElementById('ksCim').value;st_desc=document.getElementById('ksLeiras').value;if(!st_title.length){alert(lang['no_title']);return false;}
openPopupWindow(lang['create_smart_testsheet'],5,undefined,QueryString.folder);}
function smartTestsheetSettings(){refreshCimkek();var cimkek=document.getElementById('cimkek');if(cimkek){cimkek.onchange=createCimkeSpan;}}
function saveStCimkek(){if(!selectedCimkek.length){alert(lang['no_label']);return false;}
var aktCimkek='';aktCimkek=selectedCimkek.join('|');var tasks_max=document.getElementById('darab').value;var onlymine=0;if(document.getElementById('onlymine').checked){onlymine=1;}
var folder=0;var folderd=document.getElementById('folderId');if(folderd)folder=document.getElementById('folderId').value;params={'cimkek':aktCimkek,'tasks_max':tasks_max,'onlymine':onlymine,'folder':folder};ajax("saveSmartTestsheet",params,function(response){window.location.href="?edit&ks_id="+response.split('|')[1]+"&newsmart";});}
function deleteRow(elem){elem.parentNode.parentNode.removeChild(elem.parentNode);}
function setupFeladatkep(){var elemek=document.getElementsByClassName("feladatkep");for(i=0;i<elemek.length;i++){elemek[i].onclick=function(){openPictureBox(this);}
elemek[i].style.cursor="pointer";var nagyito=elemek[i].parentNode.getElementsByClassName("nagyito")[0];nagyito.onclick=function(){var kep=this.parentNode.getElementsByClassName("feladatkep")[0];openPictureBox(kep);}
nagyito.style.cursor="pointer";}}
function voteInit(){var elems=document.getElementsByClassName("ks_vote");for(i=0;i<elems.length;i++){var classs=elems[i].getAttribute("class").split(' ');kid=classs[2].substr(4);myvotes[kid]=parseInt(document.getElementById("my_"+kid).innerHTML);elems[i].onmouseover=function(){this.style.cursor="pointer";var n=parseInt(this.id.substr(5))+1;var classs=this.getAttribute("class").split(' ');kid=classs[2].substr(4);for(o=0;o<5;o++){document.getElementById("vote_"+o+"_"+kid).setAttribute("class","ks_star ks_vote kid_"+kid);}
for(o=0;o<n;o++){document.getElementById("vote_"+o+"_"+kid).setAttribute("class","ks_star ks_vote kid_"+kid+" active");}
document.getElementById("my_"+kid).innerHTML=n;}
elems[i].onmouseout=function(){var classs=this.getAttribute("class").split(' ');kid=classs[2].substr(4);for(o=0;o<5;o++){document.getElementById("vote_"+o+"_"+kid).setAttribute("class","ks_star ks_vote kid_"+kid);}
for(o=0;o<myvotes[kid];o++){document.getElementById("vote_"+o+"_"+kid).setAttribute("class","ks_star ks_vote kid_"+kid+" active");}
document.getElementById("my_"+kid).innerHTML=myvotes[kid];}
elems[i].onclick=function(){var classs=this.getAttribute("class").split(' ');kid=classs[2].substr(4);var n=parseInt(this.id.substr(5))+1;myvotes[kid]=n;if(ks_cache[akt_kerdes]&&akt_kerdes){ks_cache[akt_kerdes]='';}
var params={};params['ks_id']=QueryString.ks_id;params['kid']=kid;params['star']=n;ajax("saveStars",params,function(response){var json=JSON.parse(response);document.getElementById("avg_"+json[0]).innerHTML=json[1];});}}}
function changelang(lang){var params={};params['lang']=lang;ajax("change_lang",params,function(){window.location.reload();});}
function updateEredmenyek(){var csid=-1,page=0,preview=1;if(QueryString.csid){csid=QueryString.csid;preview=0;}
if(QueryString.page){page=QueryString.page;}
var params={};params['ks_id']=ks_id;params['preview']=preview;params['csid']=csid;params['page']=page;ajax("updateEredmenyek",params,function(response){if(response!="noupdate"){document.getElementById("eredmenyekContent").innerHTML=response;$.Metro.initPanels();setFilterForResults();}
if(document.getElementById('lastSaved')){document.getElementById('lastSaved').style.display='block';datumki("idopont");}});}
function datumki(id){if(document.getElementById(id)){lastSave=new Date();var hour=lastSave.getHours();var min=lastSave.getMinutes();var sec=lastSave.getSeconds();if(hour<10)hour="0"+hour;if(min<10)min="0"+min;if(sec<10)sec="0"+sec;document.getElementById(id).innerHTML=lang['today']+" "+hour+':'+min+':'+sec;}}
function ajax_run2(postdata,func,szinkron,noheader){last_postdata=postdata;startload();var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(e){if(this.readyState==4){redlog("AJAX response: "+this.responseText);last_response="";if(this.responseText!=""){var response=this.responseText;if(response=="kidobott"){loggedout();}else{try{var json=JSON.parse(response);if(!json.hiba){if(func!="")func(response);last_response=response;}else{var msg="";for(var i=0;i<(json.length-1);i++){msg=msg+json[i];}
alert(msg);}}catch(e){if(func!="")func(response);}}}
else alert(lang['error']);endload();}};redlog("AJAX send, postdata: "+postdata);if(!szinkron){xhr.open("POST","ajax.php",true);}
else{xhr.open("POST","ajax.php",false);}
if(!noheader){xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");}
xhr.send(postdata);}
function ajax2(action,params,func,extraparam,szinkron){func=typeof func!=='undefined'?func:"";var paramslist="";for(var key in params){if(key==='length'||!params.hasOwnProperty(key))continue;paramslist+="&"+key+"="+params[key];}
if(extraparam)paramslist+="&"+extraparam;var postdata="action="+action+paramslist;ajax_run2(postdata,func,szinkron);}
function gebi(id){return document.getElementById(id);}
function delTaskOfMine(){if(window.location.search.substr(0,6)!="?cloud")return false;if(!confirm(lang['delete_confirm'])){closepopup();return false;}
ajax2('deleteKerdes',{'kid':akt_kerdes,'delTasks':delTasks},afterDelTask,"",false);}
function afterDelTask(response){if(response!='error'){document.getElementById(response).parentNode.removeChild(document.getElementById(response));document.getElementById('kerdesBlokkValaszok').innerHTML='<h5>'+lang["here_to_manage_tasks"]+'</h5>';document.getElementById('kerdesInfo').style.display="none";document.getElementById('kerdesInfo').innerHTML=lang['loading'];document.getElementById('ksKerdesManage').style.display="none";document.getElementById('ksEditFeladat').style.display="none";document.getElementById('DelFeladat').style.display="none";document.getElementById('kerdesBlokkTitel').style.display="none";}else{alert(lang['error']);}
delTasks=false;}
function saveKerdesOrPopUp(){if(ks_id>0)openPopupWindow(lang["change_tasks"],8);else{openPopupWindow(lang["change_tasks"],9);}}
function beforeSaveKerdes(){if(document.getElementById('old_kid')){mentKerdes(false,true);}else{if(!saving)saving=true;mentKerdes(true);}}
function abTest(str){var params={};params['code']=str;ajax2('abTest',params,'','',1);}
function deleteThisKs(){var params={};params['ks_id']=ks_id;ajax2('deleteKs',params,'','',1);}
function obj_keres(obj){var obj_id;var minc=0;if(obj==1){keresmezo="userKeres";talalatmezo="userTalalat";actionfuggveny="searchUserForAdd";obj_id=QueryString.csid;minc=2;}else if(obj==2){keresmezo="userKeres2";talalatmezo="userTalalat";actionfuggveny="searchUserForShare";obj_id=QueryString.ks_id;minc=2;}else if(obj==3){keresmezo="groupName";talalatmezo="share_groupSearch";actionfuggveny="searchGroupForShare";obj_id=QueryString.ks_id;minc=1;}else{return false;}
var val=document.getElementById(keresmezo).value;var short=false;if(val==""||val.length<=minc){short=true;}
if(short){if(document.getElementById(talalatmezo)){document.getElementById(talalatmezo).innerHTML="";}
latestSearchWord2[obj]="";}
if(val==latestSearchWord2[obj]||short){return false;}
latestSearchWord2[obj]=val;var params={};params['string']=val;params['id']=obj_id;ajax(actionfuggveny,params,function(response){if(response!="NO"){document.getElementById(talalatmezo).innerHTML=response;setupObjButtons();}else{latestSearchWord2[obj]=true;document.getElementById(talalatmezo).innerHTML="<h6>Nincs találat.</h6>";}});}
function setupObjButtons(){var elems=document.getElementsByClassName("editgrdate");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var csid=this.id.substr(3);ks_id=QueryString.ks_id;openKsMetaBox2(csid);}}
var elems=document.getElementsByClassName("addcsfile");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var idm=this.id.split('_');var cstid=idm[1];var filename=idm[2];var params={};params['csid']=QueryString.csid;params['cstid']=cstid;params['filename']=filename;ajax("saveGroupShare2",params,function(res){closepopup();document.getElementById("lista2for"+cstid).innerHTML+=res;setupObjButtons();});}}
var elems=document.getElementsByClassName("addflap");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var idm=this.id.split('_');var cstid=idm[1];var ks_id=idm[2];var params={};params['csid']=QueryString.csid;params['cstid']=cstid;params['ks_id']=ks_id;ajax("saveGroupShare",params,function(res){closepopup();document.getElementById("listafor"+cstid).innerHTML+=res;setupObjButtons();});}}
var elems=document.getElementsByClassName("addgroup");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var csid=this.id.substr(3);var params={};params['csid']=csid;params['ks_id']=QueryString.ks_id;ks_id=QueryString.ks_id;document.getElementById("share_groupSearch").removeChild(document.getElementById("gr1"+csid));ajax("saveGroupShare",params,function(res){document.getElementById("share_groupInvited").innerHTML+=res;setupObjButtons();openKsMetaBox2(csid);});}}
var elems=document.getElementsByClassName("cstdelfile");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var filename=this.id.substr(3);var cstid=this.parentNode.id.substr(9);var csid=QueryString.csid;var params={};params['csid']=csid;params['cstid']=cstid;params['filename']=filename;redlog(params);document.getElementById("lista2for"+cstid).removeChild(document.getElementById("sor"+filename));document.getElementById("lista2for"+cstid).removeChild(this);ajax("delGroupShare2",params,function(res){setupObjButtons();});}}
var elems=document.getElementsByClassName("cstdelflp");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var ks_id=this.id.substr(3);var cstid=this.parentNode.id.substr(8);var csid=QueryString.csid;var params={};params['csid']=csid;params['cstid']=cstid;params['ks_id']=ks_id;document.getElementById("listafor"+cstid).removeChild(document.getElementById("sor"+ks_id));document.getElementById("listafor"+cstid).removeChild(this);ajax("delGroupShare",params,function(res){setupObjButtons();});}}
var elems=document.getElementsByClassName("addedgroup");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var csid=this.id.substr(3);var params={};params['csid']=csid;params['ks_id']=QueryString.ks_id;document.getElementById("share_groupInvited").removeChild(document.getElementById("gr2"+csid));ajax("delGroupShare",params,function(res){setupObjButtons();});}}
var elems=document.getElementsByClassName("adduser2");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var uid=this.id.substr(3);var params={};params['uid']=uid;params['ks_id']=QueryString.ks_id;params['jog']=document.getElementById("szintForUs2"+uid).value;document.getElementById("userTalalat").removeChild(document.getElementById("gus1"+uid));ajax("saveShare",params,function(res){document.getElementById("addedUsers").innerHTML+=res;setupObjButtons();});}}
var elems=document.getElementsByClassName("addeduser2");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var uid=this.id.substr(3);var params={};params['uid']=uid;params['ks_id']=QueryString.ks_id;document.getElementById("addedUsers").removeChild(document.getElementById("gus2"+uid));ajax("jogDel",params,function(res){setupObjButtons();});}}
var elems=document.getElementsByClassName("adduser1");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var uid=this.id.substr(3);var params={};var uszint=document.getElementById("szintForUs1"+uid).value;params['uid']=uid;params['csid']=QueryString.csid;params['szint']=uszint;document.getElementById("userTalalat").removeChild(document.getElementById("gus1"+uid));ajax("addUserToGroup",params,function(res){var divid="addedUsers";if(uszint==1)divid="addedUsers2";document.getElementById(divid).innerHTML+=res;setupObjButtons();});}}
var elems=document.getElementsByClassName("adduser9");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var uid=this.id.substr(3);var params={};var uszint=document.getElementById("szintForUs"+uid).value;params['uid']=uid;params['csid']=QueryString.csid;params['szint']=uszint;document.getElementById("userWaitinglist").removeChild(document.getElementById("gus9"+uid));ajax("addUserToGroup",params,function(res){var divid="addedUsers";if(uszint==1)divid="addedUsers2";var elems=document.getElementsByClassName("adduser9");if(elems.length==0){$("#waitinglistpanel").hide();}
document.getElementById(divid).innerHTML+=res;setupObjButtons();});}}
var elems=document.getElementsByClassName("deluser9");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){var uid=this.id.substr(3);var params={};params['uid']=uid;params['csid']=QueryString.csid;document.getElementById("userWaitinglist").removeChild(document.getElementById("gus9"+uid));ajax("removeFromWaitingList",params,function(res){var elems=document.getElementsByClassName("adduser9");if(elems.length==0){$("#waitinglistpanel").hide();}
setupObjButtons();});}}
var elems=document.getElementsByClassName("addeduser1");for(var i=0;i<elems.length;i++){elems[i].onclick=function(){if(window.confirm(lang['exit_group'])){var uid=this.id.substr(3);var mine=false;if($(this).hasClass("mine")){mine=true;}
var params={};params['uid']=uid;params['csid']=QueryString.csid;document.getElementById("gus2"+uid).parentNode.removeChild(document.getElementById("gus2"+uid));ajax("delUserFromGroup",params,function(res){if(mine){window.location.reload();}
setupObjButtons();});}}}}
function changeSkalaValaszokSzama(){var num=this.value;var divs=document.getElementById('valaszlehet').getElementsByClassName('skala_valasz_div');var length=divs.length;if(length<num){var lastVal=divs[divs.length-1].getElementsByTagName('input')[0].value;for(var i=0;i<(num-length);i++){sorszam=length+i;var new_elem=document.createElement('div');new_elem.setAttribute('class','skala_valasz_div');var s=document.createElement('span');s.setAttribute('class','skala_num');s.innerHTML=sorszam;new_elem.appendChild(s);new_elem.innerHTML=new_elem.innerHTML+'. <input type="text" id="skala_valasz'+sorszam+'" name="skala_valasz'+sorszam+'" value="'+sorszam+'" />';if(i==0)new_elem.getElementsByTagName('input')[0].value=lastVal;divs[0].parentNode.insertBefore(new_elem,divs[divs.length-1]);}
divs[divs.length-1].getElementsByClassName('skala_num')[0].innerHTML=num;divs[divs.length-1].getElementsByTagName('input')[0].setAttribute('id','skala_valasz'+num);divs[divs.length-1].getElementsByTagName('input')[0].setAttribute('name','skala_valasz'+num);divs[divs.length-1].getElementsByTagName('input')[0].value=num;}else if(length>num){var newLastVal=divs[num-1].getElementsByTagName('input')[0].value;while(divs.length!=num){divs[0].parentNode.removeChild(divs[divs.length-2]);}
divs[divs.length-1].getElementsByClassName('skala_num')[0].innerHTML=num;divs[divs.length-1].getElementsByTagName('input')[0].setAttribute('id','skala_valasz'+num);divs[divs.length-1].getElementsByTagName('input')[0].setAttribute('name','skala_valasz'+num);divs[divs.length-1].getElementsByTagName('input')[0].value=newLastVal;}}
function showProfileEditForm(){var saveProfilChanges=document.getElementById('saveProfilChanges');if(saveProfilChanges){saveProfilChanges.style.display="inline-block";saveProfilChanges.onclick=saveProfileData;}else{return;}
document.getElementById('editProfil').style.display='none';var elems=document.getElementsByClassName("profildata");for(var i=0;i<elems.length;i++){var text=elems[i].innerHTML;text=text.trim();if(text.substr(0,3)=="<i>")text="";var id=elems[i].id.substr(3);var type=elems[i].getAttribute("type");elems[i].innerHTML='<input type="'+type+'" id="'+id+'" value="'+text+'" />';}}
function saveProfileData(){var tomb=document.getElementById('profil_bal').getElementsByTagName('input');var params={};for(var i=0;i<tomb.length;i++){var this_id=tomb[i].getAttribute('id').split('_')[1];params[this_id]=tomb[i].value;}
ajax2("saveProfilData",params,showProfile,'',0);}
function showProfile(){var saveProfilChanges=document.getElementById('saveProfilChanges');saveProfilChanges.style.display="none";document.getElementById('editProfil').style.display='inline-block';var elems=document.getElementsByClassName("profildata");for(var i=0;i<elems.length;i++){var id=elems[i].id.substr(3);var text=document.getElementById(id).value;elems[i].innerHTML=text;}}
function deleteCurrentProfilePic(){if(document.getElementById('profilePicture').getAttribute('src')=='profile_pic/default.png')return false;ajax2("delProfilePic",{},updateProfilePic,'',0);}
function uploadProfilePicture(){var f_input=document.getElementById('profilePicInput');if(f_input.files.length==0)return false;formdata=new FormData();if(!formdata){alert(lang['old_browser']);return false;}
profilePic=f_input.files[0];formdata.append('action','uploadProfilePic');formdata.append('files[]',profilePic);ajax_run2(formdata,updateProfilePic,false,1);}
function updateProfilePic(response){closepopup();if(response=='ok'&&profilePic)showUploadedItem(profilePic,'profilePicture');else if(response=='ok')document.getElementById('profilePicture').setAttribute('src','profile_pic/default.png');profilePic='';}
function showUploadedItem(file,theid){var reader=new FileReader();reader.onload=(function(theFile){return function(e){document.getElementById(theid).src=e.target.result;document.getElementById(theid).style.display="inline";};})(file);reader.readAsDataURL(file);profilePic='';}
function uploadDokumentumFunction(){var f_input=document.getElementById('dokumentumUploadInput');var ow=document.getElementById('ow_file_name');if(f_input.files.length==0&&!ow)return false;formdata=new FormData();if(!formdata){alert(lang['old_browser']);return false;}
doc=f_input.files[0];var f_name=document.getElementById('tananyag_cim').value;var f_leiras=document.getElementById('tananyag_leiras').value;var f_cimkek=document.getElementById('tananyag_cimkek').value;formdata.append('action','uploadDokumentum');formdata.append('name',f_name);formdata.append('leiras',f_leiras);formdata.append('cimkek',f_cimkek);formdata.append('files[]',doc);if(ow){formdata.append('ow',ow.value);}
ajax_run2(formdata,function(response){if(response!='ok'){alert(response);}else{closepopup();}window.location="?dokumentumtar&page=1&order_param=timestamp&order_type=DESC";},false,1);}
function deleteThisFile(){if(!confirm('Biztos, hogy törölni szeretnéd ezt a fájlt?'))return false;var this_id=this.getAttribute("id");var params={};params['filename']=this_id;ajax2("deleteFile",params,function(response){window.location="?dokumentumtar&page=1&order_param=timestamp&order_type=DESC";},false,1);}
function temakorAction(){params={};params['csid']=QueryString.csid;params['cstid']=document.getElementById("cs_cstid").value;params['name']=document.getElementById("cs_temakor").value;params['start']=document.getElementById("cs_start").value;params['end']=document.getElementById("cs_end").value;if(params['name'].length>1&&params['start'].length>1&&params['end'].length>1){ajax2("temakorAction",params,function(res){if(res!="hiba"&&res!="error"){window.location.reload();closepopup();}});}else{alert("Az összes adatot kötelező megadni!");}}
function tallozas(){var id=this.id;var tipus=id.substr(0,2);var realid=id.substr(2);if(tipus=="b1"){openPopupWindow("Új tananyag hozzáadása",19,450,realid);}else if(tipus=="b2"){openPopupWindow("Új feladatlap hozzáadása",18,450,realid);}}
function closeAttachmentThing(){var deletedAtt=document.getElementById('deletedAttachments');if(deletedAtt){deletedAtt.value=deletedAtt.value+this.parentNode.getAttribute('id')+'|';}
delete attachments[this.parentNode.getAttribute('id')];document.getElementById('attachment_input').value="";this.parentNode.parentNode.removeChild(this.parentNode);formdata=new FormData();already_in_formdata=new Array;}
function meditor_toggle(firstload){var medit=document.getElementById("medit_load").value;redlog("Formula editor: "+medit);if(medit==1){document.getElementById("szoveg2").style.display="none";document.getElementById("medit").style.display="block";if(!firstload)$("#medit #in").html("");$('#medit').calculator();var text=document.getElementById("szoveg").value;if(!firstload)text=str_replace(" ","\\:",text);text=str_replace("\\enter","\\enter ",text);text=str_replace("\n","\\enter ",text);$("#medit #in").mathquill('write',text);document.getElementById("medit_load").value=0;document.getElementById("toggleeditor").innerHTML=lang['original_editor'];}
else{document.getElementById("szoveg2").style.display="block";document.getElementById("medit").style.display="none";if(!firstload){var _text=readRedLatex();_text=str_replace("\\:","",_text);document.getElementById("szoveg").value=_text;}
document.getElementById("medit_load").value=1;document.getElementById("toggleeditor").innerHTML=lang['formula_editor'];}}
function readRedLatex(){var redlatex=$("#medit #in").mathquill('latex');return redlatex;}
function setupRedLatex(){$('.mathquill-embedded-latex').each(function(i){var original=$(this).html();if(original.substr(0,1)!="<"&&$(this).outerHeight()>0){$(this).mathquill();}});}
function approveResults(){params={};params['ks_id']=QueryString.ks_id;params['uid']=QueryString.uid;params['attempt']=QueryString.attempt;ajax2("approveResults",params,function(res){if(res!="hiba"){document.getElementById("apprvr").style.display="none";alert(lang['sccsf']);}});}
function approveAllResults(_this){if(!confirm(lang['areyousure1'])){return false;}
var realid=_this.id.split('_')[1];var uids=document.getElementById("uids_"+realid).value;if(uids.length==0){return false;}
params={};params['ks_id']=QueryString.ks_id;params['uids']=uids;ajax2("approveAllResults",params,function(res){if(res!="hiba"){document.getElementById("apprvr2_"+realid).style.display="none";window.location.reload();}});}
function editFoldersButton(){var editFolders=document.getElementById('editFolders');if(editFolders)editFolders.onclick=openEditFolders;}
function createFolder(){var foldername=document.getElementById("newfolder_name").value.trim();if(foldername.length<1){return false;}
document.getElementById("newfolder_name").value="";if(isThereSameFolder(foldername)){return false;}
params={};params['name']=foldername;params['ks_id']=ks_id;ajax2("createFolder",params,function(res){if(res.toLowerCase().substr(0,4)=="hiba"||res.toLowerCase().substr(0,5)=="error"||res=="0"){redlog("Error: "+res);return false;}
var elem=document.createElement("span");elem.innerHTML=res;document.getElementById("folders_container").appendChild(elem);setupfolderselect();setPopupSize();refreshFolders();});}
function isThereSameFolder(foldername){var elems=document.getElementsByClassName("folder_item");for(var i=0,max=elems.length;i<max;i++){var thisname=elems[i].getElementsByClassName("name")[0].innerHTML;if(thisname==foldername||thisname.toLowerCase()==foldername.toLowerCase()){return true;}}
return false;}
function refreshFolders(hardRefresh){var container=gebi("main_page_folders_container");if(container&&hardRefresh==1){window.location.href="?";}else if(container){ajax2("refreshFolders",{folder:QueryString.folder},function(res){if(res){container.innerHTML=res;setupfolderselect();editFoldersButton();}})}}
function setupfolderselect(){$("#folder_success").hide();var elems=document.getElementsByClassName("folder_item");for(var i=0,max=elems.length;i<max;i++){if(QueryString.ks_id){elems[i].onclick=function(e){var target=e.toElement||e.target;if(target.className=="icon-remove"){return false;}
if(document.getElementsByClassName("folder_selected")[0]==this){return true;}
$(document.getElementsByClassName("folder_selected")[0]).toggleClass("folder_selected");$(this).toggleClass("folder_selected");var params={};params['fid']=this.id.substr(2);params['ks_id']=QueryString.ks_id;ajax("addToFolder",params,function(){closepopup();setTimeout(function(){sikeresMentes(1);},200);});};}
if(elems[i].getElementsByClassName("icon-remove")[0]){elems[i].getElementsByClassName("icon-remove")[0].onclick=function(){var parent=this.parentNode;var params={};params['fid']=parent.id.substr(2);ajax("deleteFolder",params,function(){parent.parentNode.removeChild(parent);setPopupSize();refreshFolders(1);});};}
if(elems[i].getElementsByClassName("icon-pencil")[0]){elems[i].getElementsByClassName("icon-pencil")[0].onclick=function(){var parent=this.parentNode;var name=parent.getElementsByClassName("name")[0].innerHTML;var newName=window.prompt("Mappa átnevezése:",name);if(newName!=null&&newName!=name&&newName.trim().length>0){if(isThereSameFolder(newName)){return false;}
var params={};var folderId=parent.id.substr(2);params['fid']=folderId;params['name']=newName.trim();ajax("renameFolder",params,function(res){parent.getElementsByClassName("name")[0].innerHTML=newName;if(QueryString.folder==folderId){window.location.href='?folder='+res;}else{refreshFolders();}});}};}}}
function setupPointLimitCopy(){if(document.getElementById("plim_sablon")){document.getElementById("plim_sablon").onchange=function(){var ertek=this.value;if(ertek>=0){var params={};params['ks_id']=ertek;ajax("getPointLimitByKsId",params,function(res){document.getElementById('percents').innerHTML=res;smartTestsheetSettings();$.Metro.initInputs();redPopupAutoResize();refreshPopupSettings();refreshPonthatarPopup();});}}}}
function loggedout(){alert(lang['logged_out']);window.location.reload();}
function setFilterForResults(){if(!document.getElementById("groupFilter"))return;var filters=document.getElementById("groupFilter").getElementsByClassName("filter");filters[0].onclick=function(){filterForResults("resultpanel",0);};filters[1].onclick=function(){filterForResults("results",1);};filters[2].onclick=function(){filterForResults("noresults",2);};}
function filterForResults(classname,buttonN){$("#groupFilter .filter").removeClass("objitem_active");$(document.getElementById("groupFilter").getElementsByClassName("filter")[buttonN]).addClass("objitem_active");var all=document.getElementsByClassName("resultpanel");for(var i=0,max=all.length;i<max;i++){all[i].style.display="none";}
var filtered=document.getElementsByClassName(classname);for(var i=0,max=filtered.length;i<max;i++){filtered[i].style.display="block";}}
function delThisAnswer(){var this_sorszam=this.parentNode.getAttribute('id').substr(16);var elemek=document.getElementById('valaszlehet').getElementsByClassName('valasz_opcio');var ize=new Array;ize=good_answers.slice();good_answers=new Array;for(var o=1;o<=elemek.length;o++){if(o!=this_sorszam&&ize.indexOf(o.toString())>=0&&good_answers.indexOf(o.toString())<0){if(o<=this_sorszam){good_answers.push(o.toString());}else{var ccc=o-1;good_answers.push(ccc.toString());}}}
for(var i=this_sorszam;i<elemek.length;i++){elemek[i-1].getElementsByTagName('input')[0].value=elemek[i].getElementsByTagName('input')[0].value;if(elemek[i-1].getElementsByTagName('input')[1])elemek[i-1].getElementsByTagName('input')[1].value=elemek[i].getElementsByTagName('input')[1].value;if(elemek[i].getElementsByClassName('selectJoValasz').length>0){if(elemek[i].getElementsByClassName('selectJoValasz')[0].style.display=='none'){elemek[i-1].getElementsByClassName('selectJoValasz')[0].style.display='none';elemek[i-1].getElementsByClassName('selectJoValaszSimpleMegse')[0].style.display='inline-block';}else{elemek[i-1].getElementsByClassName('selectJoValasz')[0].style.display='inline-block';elemek[i-1].getElementsByClassName('selectJoValaszSimpleMegse')[0].style.display='none';}}else if(elemek[i].getElementsByClassName('selectJoValaszMultiple').length>0){if(elemek[i].getElementsByClassName('selectJoValaszMultiple')[0].style.display=='none'){elemek[i-1].getElementsByClassName('selectJoValaszMultiple')[0].style.display='none';elemek[i-1].getElementsByClassName('selectJoValaszMultipleMegse')[0].style.display='inline-block';}else{elemek[i-1].getElementsByClassName('selectJoValaszMultiple')[0].style.display='inline-block';elemek[i-1].getElementsByClassName('selectJoValaszMultipleMegse')[0].style.display='none';}}
if(elemek[i].getElementsByClassName('check').length>0){if(elemek[i].getElementsByTagName('span')[1].getElementsByTagName('input')[0].checked){elemek[i-1].getElementsByTagName('span')[1].getElementsByTagName('input')[0].checked=true;}else{elemek[i-1].getElementsByTagName('span')[1].getElementsByTagName('input')[1].checked=true;}}}
elemek[elemek.length-1].parentNode.removeChild(elemek[elemek.length-1]);setupDelAnswer();}
function setupDelAnswer(){for(var i=1,max=6;i<=max;i++){var elemek=document.getElementById('valaszlehet').getElementsByClassName('dao'+i);if(elemek.length==0){continue;}
if(!document.getElementById('egyszavas_table')){if(elemek.length<=2){$(".dao"+i).css("visibility","hidden");}else{$(".dao"+i).css("visibility","visible");}}else{if(elemek.length==1){$(".dao"+i).css("visibility","hidden");}else{$(".dao"+i).css("visibility","visible");}}}}
function openExport(){var filter=0;if(document.getElementById("groupFilter")){var filters=document.getElementById("groupFilter").getElementsByClassName("filter");if($(filters[1]).hasClass("objitem_active")){filter=1;}
if($(filters[2]).hasClass("objitem_active")){filter=2;}}
abTest('exp_'+QueryString.ks_id+"_"+QueryString.csid+"_"+filter);window.location.href="export.php?ks_id="+QueryString.ks_id+"&csid="+QueryString.csid+"&filter="+filter;}
function setPopupSize(){hh=window.innerHeight;if(hh>=maxh){maxh=hh+2;}
if(document.body.clientHeight>=maxh){maxh=document.body.clientHeight+2;}
if(!gebi("r_popup")||typeof removejscssfile!="undefined"){abTest('rickroll2');solving_in_progress=false;window.location.href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&lol';}
var popup=gebi("r_popup");var popw=popup.offsetWidth;var poph=popup.offsetHeight;var popl=(ww-popw)/2;var popt=(hh-poph)/2;setTimeout(function(){if(!gebi("r_popup")||typeof removejscssfile!="undefined"){abTest('rickroll3');solving_in_progress=false;window.location.href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&lol';}},1000);gebi("r_popupback").style.position="fixed";gebi("r_popupback").style.height=maxh+"px";gebi("r_popup").style.position="fixed";gebi("r_popup").style.marginLeft=popl+"px";gebi("r_popup").style.marginTop=popt+"px";if(ww<popw||popl<0){gebi("r_popup").style.marginLeft="0px";}
if(hh<poph||popt<0){gebi("r_popup").style.position="absolute";gebi("r_popup").style.marginTop="0px";}
setTimeout(function(){if(!gebi("r_popup")||typeof removejscssfile!="undefined"){abTest('rickroll4');solving_in_progress=false;window.location.href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&lol';}},6000);}
function redPopupAutoResize(){setPopupSize();}
function setPopupTitle(title){if(!title){gebi("r_popuptitle").style.display="none";}else{gebi("r_popuptitle").style.display="block";}
gebi("r_popuptitle").innerHTML=title;}
function setPopupContent(content){gebi("r_popupcontent").innerHTML=content;}
function setPopupWidth(w){if(w>ww){w=ww;}
gebi("r_popup").style.maxWidth=w+"px";}
function closepopup(){if(popupstate=="closed"){return false;}
popupstate="closed";$("#r_popup").animate({opacity:0},200,function(){$(this).css("display","none");if(popupstate=="closed"){setPopupContent(lang['loading']);}});$("#r_popupback").animate({opacity:0},200,function(){$(this).css("display","none");});}
function openpopup(rightnow){gebi("r_popup").style.display="block";gebi("r_popupback").style.display="block";if(popupstate=="opened"){setPopupSize();return false;}
popupstate="opened";if(rightnow==1){gebi("r_popup").style.opacity=1;gebi("r_popupback").style.opacity=0.6;setPopupSize();return true;}
setPopupSize();gebi("r_popup").style.opacity=0;gebi("r_popupback").style.opacity=0;$("#r_popup").animate({opacity:1},{step:function(now,fx){$(fx.elem).css("display","block");},duration:300});$("#r_popupback").animate({opacity:0.6},{step:function(now,fx){$(fx.elem).css("display","block");},duration:300});}
function setupnewpopup(){$(".r_popupclose").click(function(){closepopup();});$("#r_popupback").click(function(){closepopup();});}
function openPopupWindow(titlem,n,widthm,extra,params,cb){widthm=(typeof widthm!=='undefined'&&widthm>0)?widthm:460;extra=(typeof extra!=='undefined')?extra:"";if(!gebi("r_popup")){abTest('rickroll1');solving_in_progress=false;window.location.href='https://www.youtube.com/watch?v=dQw4w9WgXcQ&lol';}
setPopupTitle(titlem);setPopupContent(lang['loading']);setPopupWidth(widthm);openpopup(0);var adatok={};adatok['n']=n;adatok['ks_id']=ks_id;adatok['extra']=extra;for(var key in params){if(key==='length'||!params.hasOwnProperty(key))continue;adatok[key]=params[key];}
if(n==17||n==18||n==19){adatok['csid']=QueryString.csid;}
if(n==2){ajax("getPopup",adatok,setKsMetaBox);}else if(n==4){ajax("getPopup",adatok,setPonthatarPopup);}else if(n==5){if(st_title.length){adatok['title']=st_title;adatok['desc']=st_desc;}
ajax("getPopup",adatok,function(response){popupUpload(response);smartTestsheetSettings();});}else{ajax("getPopup",adatok,function(response){popupUpload(response);if(cb&&typeof cb=='function')cb();});}}
function openPictureBox(picture){szeles=0;var img=new Image();img.addEventListener("load",function(){szeles=(this.naturalWidth/this.naturalHeight*(hh-80));if(szeles>ww)szeles=(ww-10);if(szeles>this.naturalWidth)szeles=this.naturalWidth;var tmp=document.createElement("div");tmp.appendChild(this);redlog(tmp.innerHTML);setPopupTitle('Redmenta');setPopupContent(tmp.innerHTML);setPopupWidth(szeles);openpopup(0);});img.src=picture.getAttribute("src").substr(0,picture.getAttribute("src").length-14)+'.png';}
function ytvideo(video){var ytw=580;if(ytw>ww){ytw=ww-10;}
var yth=315/560*(ytw-20);setPopupTitle('Redmenta');setPopupWidth(ytw);setPopupContent('<iframe width="'+(ytw-20)+'" height="'+yth+'" src="'+video+'" frameborder="0" allowfullscreen></iframe>');openpopup(0);}
function popupUpload(response){setPopupContent(response);$.Metro.initInputs();$.Metro.initPanels();refreshPopupSettings();$(".panel-header").click(function(){var thisitem=$(this).parent().get(0);$(".popuppanel").each(function(){if($(this).get(0)!=thisitem){if($(this).hasClass('collapsed')==false){$(this).children('.panel-content').slideToggle('fast',function(){if($(this).hasClass('collapsed')==false){$(this).parent().toggleClass('collapsed');}});}}});var intev=setInterval(function(){redPopupAutoResize();},5);setTimeout(function(){clearInterval(intev);redPopupAutoResize();resize();},200);});jQuery('.dtpicker').datetimepicker({lang:'hu',step:15,closeOnDateSelect:true,dayOfWeekStart:1});openpopup(0);}
function redalert(s,force){if(popupstate=="opened"&&force!=1){alert(s);return false;}
setPopupTitle(lang['alert_message']);setPopupWidth(400);setPopupContent(nl2br(s,1)+'<div><button class="r_popupclose" id="cls_rda" style="margin-top: 10px">OK</button></div>');openpopup(0);setupnewpopup();gebi("cls_rda").focus();}
function check_if_embeded(){if(window!=window.top){$("body").addClass("red_embeded");$(".navigation-bar").removeClass("normalbar");$(".navigation-bar").addClass("embededmenu");$(".if_embeded_target_blank").attr("target","_blank");saveIframeLocation();}}
function saveIframeLocation(){ajax2('iframeLocation',{},'','',1);}
function addToWaitingList(){var params={};params['csid']=QueryString.csid;ajax2("addToWaitingList",params,function(){gebi("csow1").style.display="none";gebi("csow2").style.display="inline-block";$("#after_apply").show(400);});}
function removeFromWaitingList(){var params={};params['csid']=QueryString.csid;ajax2("removeFromWaitingList",params,function(){gebi("csow2").style.display="none";gebi("csow1").style.display="inline-block";$("#after_apply").hide(400);});}
function toggleFeedback(){setupfeedback();if($("#feedbackform").hasClass("fbt_opened")){$("#feedbackform").animate({opacity:0,bottom:0},350,function(){$(this).css("display","none");$(this).removeClass("fbt_opened");$("#feedbacktool").removeClass("opened");resetError();});$("#feedbacktitle, #blokk1, #blokk2, #fb_message, #fb_footer").animate({opacity:0},250,function(){$(this).hide();});setTimeout(function(){$("#feedbacktool").animate({bottom:14,right:14},300);},50);}else{$("#feedbacktool").addClass("opened");$("#feedbackform").show();$("#feedbackform").animate({opacity:1,bottom:15},300,function(){$(this).css("display","block");$(this).addClass("fbt_opened");$('#fb_topic_s').selectmenu({position:{my:"left top-35",at:"left bottom"},width:172,change:function(event,ui){resetFeedback();}});resetFeedback();});setTimeout(function(){$("#feedbacktool").animate({bottom:29,right:30},300);},50);delayshow("feedbacktitle",200);delayshow("blokk1",250);delayshow("blokk2",300);delayshow("fb_message",350);delayshow("fb_footer",450);}}
function delayshow(div,time){setTimeout(function(){$("#"+div).show();$("#"+div).animate({opacity:1},300);},time);}
function resetFeedback(){$('#sendfeedback').show();$('#sendfeedback').css("opacity",1);$('#sendfeedback').css("left",0);$('#fb_thanks').hide();$('#fb_thanks').css("opacity",0);$('#fb_thanks').css("margin-top","-20px");resetError();}
function resetError(){$("#fb_message").animate({height:160},250);$("#fb_error").css("opacity","0");$("#fb_error").hide(250);}
function showError(){$("#fb_message").animate({height:140},250);$("#fb_error").show(250);$("#fb_error").animate({opacity:1},250);}
function setupfeedback(){addbutton("sendfeedback",sendfeedback);var feelings=document.getElementsByClassName("fb_feeling_head");for(var i=0,max=feelings.length;i<max;i++){feelings[i].onclick=function(){$(".fb_feeling_head").removeClass("fb_fl_active");$(this).addClass("fb_fl_active");resetFeedback();};}
if(gebi("fb_message")){gebi("fb_message").onkeydown=resetFeedback;}}
function sendfeedback(){var feeling=0;var readfeeling=document.getElementsByClassName("fb_fl_active");if(readfeeling.length>0){feeling=parseInt(readfeeling[0].id.split('_')[2]);}
if(!feeling){gebi("fb_error").innerHTML="Hogy érzed magad?";showError();return;}
if(gebi("fb_message").value.length<2){gebi("fb_error").innerHTML="Fejtsd ki az észrevételedet!";showError();return;}
var ajaxs="topic="+gebi("fb_topic_s").value+"|feeling="+feeling+"|message="+encodeURIComponent(gebi("fb_message").value);ajax2("sendfeedback",{"f":ajaxs,"url":encodeURIComponent(window.location.href)},function(res){if(res=="OK"){$(".fb_feeling_head").removeClass("fb_fl_active");$("#fb_topic_s").val("1");if(gebi("fb_message")){gebi("fb_message").value="";}
$('#fb_topic_s').selectmenu("refresh");$("#sendfeedback").animate({opacity:0,left:20},400,function(){$(this).css("display","none");});$("#fb_thanks").animate({opacity:1,marginTop:0},{step:function(now,fx){$(fx.elem).css("display","block");},duration:600});}});}
function openqrpage(){var ks_id=QueryString.ks_id;var params=['height='+screen.height,'width='+screen.width,'fullscreen=yes','menubar=no','location=no','status=no','titlebar=no','toolbar=no'].join(',');qrpopup=window.open("./?qr&ks_id="+ks_id,'qrpopup',params);qrpopup.moveTo(0,0);}
function closeqrpage(){this.close();}
function openPrintDialog(){openPopupWindow("Nyomtatás",22);}
function printTab(){var includes="";var inc_inputs=document.getElementsByClassName("print_includes");var c=0;for(var i=0;i<inc_inputs.length;i++){if(inc_inputs[i].checked){if(c>0){includes+=',';}
includes+=inc_inputs[i].id.substr(4);c++;}}
var header=gebi("print_header").value;var win=window.open('./?print&ks_id='+QueryString.ks_id+'&includes='+includes+'&header='+header,'_blank');win.focus();}
function whatIsArchive(event,msg){event.stopPropagation();event.preventDefault();redalert(msg);}
function goToByScroll(id){$('html,body').animate({scrollTop:$("#"+id).offset().top},'slow');}